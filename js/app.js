!function t(e,n,i){function o(r,a){if(!n[r]){if(!e[r]){var l="function"==typeof require&&require;if(!a&&l)return l(r,!0);if(s)return s(r,!0);throw new Error("Cannot find module '"+r+"'")}var u=n[r]={exports:{}};e[r][0].call(u.exports,function(t){var n=e[r][1][t];return o(n?n:t)},u,u.exports,t,e,n,i)}return n[r].exports}for(var s="function"==typeof require&&require,r=0;r<i.length;r++)o(i[r]);return o}({1:[function(t,e,n){var i=function(t){this._channels={},this.initialize(t)};i.prototype={initialize:function(t){return[].concat(t).forEach(this.createChannel,this),this},channel:function(t){if(this._channels[t])return this._channels[t];throw new Error("Not found channels:"+t)},createChannel:function(t){return this._channels[t]||(this._channels[t]=_.extend({},Backbone.Events).on("all",function(e,n){console.log("Канал: %s => %o",t,arguments)})),this._channels[t]}},e.exports=i},{}],2:[function(t,e,n){var i=t("./events");app.options=t("./options"),app.events=new i(app.options.channels),app.store=t("./store"),t("./system");var o=t("./message");app.message=new o({el:$("#temp-message-block").html()});var s=t("./modal");app.modal=new s({el:"#map-modal"})},{"./events":1,"./message":3,"./modal":4,"./options":5,"./store":6,"./system":7}],3:[function(t,e,n){var i=Backbone.View.extend({templateItem:_.template($("#temp-message-item").html()),templateHtml:_.template($("#temp-message-html").html()),defaults:{className:"alert-warning",title:"",content:"",html:"",time:0,animation:0},initialize:function(t){$("body").append(this.el)},send:function(t){t=_.defaults(t,this.defaults);var e=this._create(t);return this.$el.append(e),t.time&&this._time(e,t),e},_create:function(t){return $(t.html?this.templateHtml(t):this.templateItem(t))},_time:function(t,e){setTimeout(function(){t.hide(e.animation,function(){t.alert("close")})},e.time)}});e.exports=i},{}],4:[function(t,e,n){var i=Backbone.View.extend({defaults:{},initialize:function(t){},open:function(t){t.modal=this,this.$el.append(t.el||t).one("hidden.bs.modal",function(){this.$el.empty()}.bind(this)).modal("show")},close:function(){this.$el.modal("hide")}});e.exports=i},{}],5:[function(t,e,n){e.exports={channels:["system","screen","menu","layers","base-map","route","info","map","auth"],icons:{wp:L.divIcon({className:"map-route-icon"}),df:L.divIcon({className:"icon-marker-icon",iconSize:L.point(25,41),iconAnchor:L.point(12,41)})},layers:{SEEMARKER:{id:"SEEMARKER",title:"Маяки и буи",enableZoom:[8,30]},MARINE:{title:"Порты и марины - SkipperGuide.com",enableZoom:[4,30]},LIGTH:{title:"Порты и марины - OSM",enableZoom:[4,30]}},meteo:{WIND:{title:"Ветер",enableZoom:[3,8]},PRESS:{title:"Атмосф. давление",enableZoom:[3,8]},TEMP:{title:"Температура возд.",enableZoom:[3,8]},PRECIPITATION:{title:"Осадки",enableZoom:[3,8]},WAVE:{title:"Высота волны",enableZoom:[3,8]}}}},{}],6:[function(t,e,n){e.exports={action:"_local",get:function(t){return this[this.action](t)},set:function(t,e){return this[this.action](t,e)},_local:function(t,e){return window.localStorage?e?(window.localStorage.setItem(t,JSON.stringify(e)),!0):JSON.parse(window.localStorage.getItem(t))||{}:void 0}}},{}],7:[function(t,e,n){var i=(t("./events"),app.events.channel("screen")),o=app.events.channel("system");$(window).on("resize",_.debounce(function(){i.trigger("resize:start")}.bind(this),300,!0)).on("resize",_.debounce(function(){i.trigger("resize:end")}.bind(this),300)).on("resize",_.throttle(function(){i.trigger("resize")}.bind(this),100)).unload(function(t){o.trigger("unload")}).load(function(t){o.trigger("load")})},{"./events":1}],8:[function(t,e,n){!function(){window.app={};var e=Backbone.Router.extend({initialize:function(){t("./libs"),t("./core"),t("./modules"),Backbone.history.start()},routes:{help:"help","token/:key":"token","search/:query":"search","search/:query/p:page":"search"},help:function(){console.log("#help")},search:function(t,e){},token:function(t){app.events.channel("auth").trigger("change-password",t)},_demoMessage:function(){var t,e=8,n=app.message.send({title:"Демострация инфо сообщений",content:'Большинство погаснут через <b id="testTime">'+e+"</b> секунд. Одно надо закрыть руками",time:1e3*e});t=setInterval(function(){n.find("#testTime").text(--e)},1e3),n.one("closed.bs.alert",function(e){clearInterval(t)}),app.message.send({className:"alert-info",title:"Инфо сообщение",content:'Нажми <span class="label label-primary">Alt-1, Alt-2, Alt-3</span> для просмотра подвала.</br><small> Меня надо закрыть руками. Нажми крестик</small>'}),app.message.send({className:"alert-danger",html:"<h1>Error</h1><p>Код ошибки:<code>522</code></p>",time:4e3,animation:1e3}),app.message.send({className:"alert-success",title:"Все OK",content:"Ура !!!",time:2e3})}});new e}()},{"./core":2,"./libs":15,"./modules":36}],9:[function(t,e,n){+function(t){"use strict";function e(e){return this.each(function(){var i=t(this),o=i.data("bs.popover"),s="object"==typeof e&&e;(o||!/destroy|hide/.test(e))&&(o||i.data("bs.popover",o=new n(this,s)),"string"==typeof e&&o[e]())})}var n=function(t,e){this.init("popover",t,e)};if(!t.fn.popover)throw new Error("Popover requires popover.js");n.VERSION="3.3.5",n.DEFAULTS=t.extend({},t.fn.popover.Constructor.DEFAULTS,{html:!0,animation:!1,placement:"bottom",trigger:"manual",container:"body",content:"",template:t("#temp-menu-popover").html()||'<div class="popover" role="tooltip"><div class="arrow"></div><button class="close" type="button" style="margin-right:5px;">×</button><h3 class="popover-title"></h3><div class="popover-content"></div></div>',viewport:{selector:"body",padding:5}}),n.prototype=t.extend({},t.fn.popover.Constructor.prototype),n.prototype.constructor=n,n.prototype.tip=function(){if(!this.$tip&&(this.$tip=t(this.options.template),this.$tip.on("click","button.close",function(){this.hide()}.bind(this)),1!=this.$tip.length))throw new Error(this.type+" `template` option must consist of exactly 1 top-level element!");return this.$tip},n.prototype.getDefaults=function(){return n.DEFAULTS},n.prototype.fixTitle=function(){},n.prototype.mover=function(){var t="top",e=this.$tip.detach().css({top:0,left:0,display:"block"}).addClass(t).data("bs."+this.type,this);this.options.container?e.appendTo(this.options.container):e.insertAfter(this.$element);var n=this.getPosition(),i=e[0].offsetWidth,o=e[0].offsetHeight,s=t,r=this.getPosition(this.$viewport);t="bottom"==t&&n.bottom+o>r.bottom?"top":"top"==t&&n.top-o<r.top?"bottom":"right"==t&&n.right+i>r.width?"left":"left"==t&&n.left-i<r.left?"right":t,e.removeClass(s).addClass(t);var a=this.getCalculatedOffset(t,n,i,o);this.applyPlacement(a,t)};var i=t.fn.popover;t.fn.menuPopover=e,t.fn.menuPopover.Constructor=n,t.fn.menuPopover.noConflict=function(){return t.fn.menuPopover=i,this}}(jQuery)},{}],10:[function(t,e,n){t("./bootstrap.ext.js"),t("./underscore.ext.js"),t("./leaflet.ext.js"),t("./validation.ext.js")},{"./bootstrap.ext.js":9,"./leaflet.ext.js":11,"./underscore.ext.js":12,"./validation.ext.js":13}],11:[function(t,e,n){"use strict";L.Icon.Default.imagePath="./images",L.Map.include({_initControlPos:function(){function t(t,o){var s=n+t+" "+n+o;e[t+o]=L.DomUtil.create("div",s,i)}var e=this._controlCorners={},n="leaflet-",i=this._controlContainer=L.DomUtil.create("div",n+"control-container",this._container);t("top","center"),t("top","left"),t("top","right"),t("bottom","left"),t("bottom","right")}}),L.Point.prototype.division=function(t,e){var n=-e/(e-1),i=(this.x+n*t.x)/(1+n),o=(this.y+n*t.y)/(1+n);return L.point(i,o)},L.Point.prototype.middle=function(t){return this.division(t,2)},L.Point.prototype.toLatLng=function(t){return t.unproject(this)},L.LatLng.prototype.toPoint=function(t){return t.project(this)},L.LatLng.prototype.angle=function(t,e){var n=e.project(this),i=e.project(t),o=180*Math.atan2(n.y-i.y,n.x-i.x)/Math.PI;return(o+270)%360},L.LatLng.prototype.middle=function(t,e){var n=e.project(this),i=e.project(t);return e.unproject(n._add(i)._divideBy(2))},L.MarkerModel=L.Marker.extend({initialize:function(t,e){this.model=t,L.MarkerModel.__super__.initialize.call(this,t.get("latlng"),e)},visible:function(t){this._icon&&$(this._icon).toggle(t)}}),L.markerModel=function(t,e){return new L.MarkerModel(t,e)},L.LayerModel=L.LayerGroup.extend({options:{},initialize:function(t,e){this.model=t,L.LayerCollection.__super__.initialize.call(this,[],e)}}),L.LayerCollection=L.LayerGroup.extend({options:{},initialize:function(t,e){this.collection=t,L.LayerCollection.__super__.initialize.call(this,[],e)}}),L.layerCollection=function(t,e){return new L.LayerCollection(t,e)},L.CanvasTiles=L.TileLayer.Canvas.extend({initialize:function(t,e,n){this._userDrawFunc=t,this._callContext=n,L.setOptions(this,e);var i=this;return this.drawTile=function(t,e,n){this._draw(t,e,n),i.options.debug&&i._drawDebugInfo(t,e,n)},this},drawing:function(t){return this._userDrawFunc=t,this},params:function(t){return L.setOptions(this,t),this},addTo:function(t){return t.addLayer(this),this},_drawDebugInfo:function(t,e,n){var i=this.options.tileSize,o=t.getContext("2d");o.globalCompositeOperation="destination-over",o.strokeStyle="#FFFFFF",o.fillStyle="#FFFFFF",o.strokeRect(0,0,i,i),o.font="12px Arial",o.fillRect(0,0,5,5),o.fillRect(0,i-5,5,5),o.fillRect(i-5,0,5,5),o.fillRect(i-5,i-5,5,5),o.fillRect(i/2-5,i/2-5,10,10),o.strokeText(e.x+" "+e.y+" "+n,i/2-30,i/2-10)},tilePoint:function(t,e,n,i){var o=n.multiplyBy(i),s=t.project(new L.LatLng(e[0],e[1])),r=Math.round(s.x-o.x),a=Math.round(s.y-o.y);return{x:r,y:a}},_boundsToQuery:function(t){return void 0==t.getSouthWest()?{x:0,y:0,width:.1,height:.1}:{x:t.getSouthWest().lng,y:t.getSouthWest().lat,width:t.getNorthEast().lng-t.getSouthWest().lng,height:t.getNorthEast().lat-t.getSouthWest().lat}},_draw:function(t,e,n){var i=this.options.tileSize,o=e.multiplyBy(i),s=o.add(new L.Point(i,i)),r=new L.Point(this.options.padding,this.options.padding);o=o.subtract(r),s=s.add(r);var a=new L.LatLngBounds(this._map.unproject(s),this._map.unproject(o)),l=1/(40075016.68/i/Math.pow(2,n));this._userDrawFunc&&this._userDrawFunc.call(this._callContext,this,{canvas:t,tilePoint:e,bounds:a,size:i,zoomScale:l,zoom:n,options:this.options})}}),L.canvasTiles=function(t,e,n){return new L.CanvasTiles(t,e,n)}},{}],12:[function(t,e,n){_.templateSettings={evaluate:/\{\{([\s\S]+?)\}\}/g,interpolate:/\{\{=([\s\S]+?)\}\}/g,escape:/\{\{-([\s\S]+?)\}\}/g},_.deferContext=function(t,e){return _.defer(t.bind(e))}},{}],13:[function(t,e,n){_.extend(Backbone.Validation.callbacks,{valid:function(t,e,n){var i,o;i=t.$("["+n+"="+e+"]"),o=i.parents(".form-group"),o.removeClass("has-error"),"tooltip"==i.data("error-style")&&i.tooltip("hide"),i.data("tooltip")||("inline"==i.data("error-style")?o.find(".help-inline.error-message").remove():(o.find(".help-block.error-message").remove(),i=t.$("["+n+"="+e+"]"),o=i.parents(".control-group"),o.removeClass("error")))},invalid:function(t,e,n,i){var o,s,r,a;o=t.$("["+i+"="+e+"]"),s=o.parents(".form-group"),s.addClass("has-error"),"tooltip"==o.data("error-style")?(r=o.data("tooltip-position")||"right",o.tooltip({placement:r,trigger:"manual",title:n}),o.tooltip("show")):"inline"==o.data("error-style")?(0==s.find(".help-inline").length&&s.find(".form-control").after("<span class='help-inline error-message'></span>"),a=s.find(".help-inline"),a.text(n)):(0==s.find(".help-block").length&&s.find(".form-control").after("<p class='help-block error-message'></p>"),a=s.find(".help-block"),a.text(n))}}),_.extend(Backbone.Validation.validators,{remote:function(t,e,n,i,o){var s=o[i.remoteField];if(s){if(n.fn)return n.fn(s,i,o);if(!n.status)return s.statusText;s.status===n.status&&n.mes}},remoteErr400:function(t,e,n,i,o){var s=o[i.remoteField];return s&&400===s.status?n.mes||s.responseJSON.errors[e]:void 0}})},{}],14:[function(t,e,n){var i=Backbone.View.extend({el:$("#temp-footer").html(),height:30,maxHeight:50,minHeight:20,winHeight:$(window).height(),events:{"click button.close":"onClose","mousedown div.map-footer-resize-vertical":"onMousedown"},initialize:function(t){t.keyPress&&$(document).keydown(t.keyPress,this.onKeypress.bind(this)),t.content&&this.$el.append(t.content),t.height&&(this.height=t.height),t.minHeight&&(this.minHeight=t.minHeight),t.maxHeight&&(this.maxHeight=t.maxHeight),this.options=t},isDom:function(){return!!this.$el.parent().length},sizeHeight:function(t){var e=100-t/this.winHeight*100|0;e<this.maxHeight&&e>this.minHeight&&(this.height=e,this.$el.css({height:this.height+"%"}),this.trigger("resize",this.height,this))},close:function(t){this.$el.css({height:0}).detach(),!t&&this.trigger("close",0,this)},open:function(){this.$el.css({height:this.height+"%"}).appendTo("body"),this.trigger("open",this.height,this)},onKeypress:function(t){t.altKey&&t.which==t.data.charCodeAt()&&(this.isDom()?this.close():this.open())},onClose:function(t){this.close()},onOpen:function(t,e){this.isDom()&&e!==this&&this.close(!0)},onResize:function(){this.winHeight=$(window).height()},onMousedown:function(t){$(document).on("mousemove."+this.cid,this.onMousemove.bind(this)),$(document).one("mouseup."+this.cid,this.onMouseup.bind(this)),t.preventDefault()},onMouseup:function(t){$(document).off("mousemove."+this.cid),t.preventDefault()},onMousemove:function(t){var e=t.pageY;e&&this.sizeHeight(e),t.preventDefault()}});e.exports=i},{}],15:[function(t,e,n){t("./extend"),t("./plugins")},{"./extend":10,"./plugins":30}],16:[function(t,e,n){var i=Backbone.Collection.extend({url:null,model:t("./model"),initialize:function(t){this.type=t.type},isFilter:function(t){return!0},isReady:function(){return this.ready&&"resolved"===this.ready.state()},findBounds:function(t,e){return this.filter(function(n){return(e||this.isFilter)(n)&&n.isBounds(t)},this)},load:function(){return this.ready=this.fetch()}});e.exports=i},{"./model":18}],17:[function(t,e,n){var i=L.LayerGroup.extend({initialize:function(t){i.__super__.initialize.call(this,[]),this.types={},[].concat(t).forEach(this.addTypes,this)},onActive:function(t){for(var e in t)this.types[e]&&this._toggleLayer(this.types[e],t[e])},addTypes:function(t){this.types[t.getType()]=t},_toggleLayer:function(t,e){e?!t._map&&this.addLayer(t):t._map&&this.removeLayer(t)}});e.exports=i},{}],18:[function(t,e,n){var i=Backbone.Model.extend({coordName:"position",initialize:function(t){i.__super__.initialize.apply(this,arguments)},isBounds:function(t){throw Error("переопределите  метод")}});e.exports=i},{}],19:[function(t,e,n){var i=L.LayerGroup.extend({_debug:!1,options:{layer:{}},initialize:function(t,e){i.__super__.initialize.call(this,[]),L.Util.setOptions(this,e),this.collection=t},onAdd:function(t){i.__super__.onAdd.apply(this,arguments),setTimeout(function(){this._map.on("moveend",this.onRefresh,this)}.bind(this)),this.collection.isReady()?this.render():this.collection.load().done(this.onRefresh.bind(this))},onRemove:function(){this._map.off("moveend",this.onRefresh,this),this.eachLayer(this.removeLayer,this),i.__super__.onRemove.apply(this,arguments)},onRefresh:function(){this.collection.isReady()&&this.render()},render:function(){this._debug&&(console.group(this.collection.type),console.time("time"));var t=this._map.getBounds();this._addLayersInBounds(t)._removeLayersOutBounds(t),this._debug&&(console.timeEnd("time"),console.groupEnd())},create:function(t){},getType:function(){return this.collection.type},_removeLayersOutBounds:function(t){var e=this.getLayers().filter(function(e){return!e.model.isBounds(t)});return e.forEach(this.removeLayer,this),this._debug&&console.log("Remove: %s. Total: %s",e.length,this.getLayers().length),this},_addLayersInBounds:function(t){var e=this.collection.findBounds(t);return e=e.filter(function(t){return!this._getLayersModel().some(function(e){return e.id===t.id})},this),e.forEach(this.create,this),this._debug&&console.log("Add: %s",e.length),this},_getLayersModel:function(){return this.getLayers().map(function(t){return t.model})}});e.exports=i},{}],20:[function(t,e,n){var i=Backbone.View.extend({classMask:"map-loading-mask",tempMessage:$("#temp-mask-message").html(),initialize:function(){},start:function(){this._setMask(!0)},end:function(t,e,n){setTimeout(function(){this._setMask(!1),e&&e.call(n)}.bind(this),t||0)},_setMask:function(t){this.$el.toggleClass(this.classMask,t),this.$el.find("input").prop("disabled",t),this.$el.find("button").prop("disabled",t),t?this.$el.parent().append(this.tempMessage):this.$el.parent().find(".map-loading-mask-message").remove()}});e.exports=i},{}],21:[function(t,e,n){var i=L.Control.extend({options:{hide:!1,position:"topleft",className:"map-menu-button"},includes:L.Mixin.Events,initialize:function(t){L.Control.prototype.initialize.apply(this,arguments),this.id=t.id,this._create(this.options)},onAdd:function(t){return setTimeout(this._centerVertical.bind(this),0),this.fire("add",{map:t}),this.el},setVisible:function(t){return this.$el.toggle(t),this.options.hide=!t,this},isVisible:function(t){return this.$el.is(":visible")},onClick:function(t){this.fire("click",t)},_create:function(t){var e=this.el=L.DomUtil.create("div",t.className),n=L.DomEvent.stopPropagation;return L.DomEvent.on(e,"contextmenu",n).on(e,"contextmenu",L.DomEvent.preventDefault).on(e,"click",n).on(e,"mousedown",n).on(e,"dblclick",n).on(e,"click",L.DomEvent.preventDefault).on(e,"click",this.onClick,this).on(e,"click",this._refocusOnMap,this),this.$el=$(e).attr({id:t.id,title:t.title}),t.icon&&this.$el.append(t.icon),e},_centerVertical:function(){var t=this.$el.find(".map-menu-button-icon");t.length&&t.css({marginTop:(this.$el.height()-t.height())/2})}});e.exports=i},{}],22:[function(t,e,n){e.exports={Button:t("./button"),Popover:t("./popover"),Menu:t("./menu"),Manager:t("./manager")}},{"./button":21,"./manager":23,"./menu":24,"./popover":25}],23:[function(t,e,n){var i=t("./menu"),o=L.Class.extend({menuActive:null,includes:L.Mixin.Events,initialize:function(t,e){this.menus=[]},add:function(t){this.menus=this.menus.concat([].concat(t).map(this._createMenu,this))},get:function(t){return this._findMenu(t)},render:function(t){this.menus.forEach(function(e){e.button.addTo(t),e.button.options.hide&&e.button.setVisible(!e.button.options.hide)})},setVisible:function(t,e){var n=t instanceof i?t:this._findMenu(t);n&&(!e&&n.setActive(e),n.button.setVisible(e))},setActive:function(t,e){var n=t instanceof i?t:this._findMenu(t);return n&&n.setActive(e),this},onActive:function(t){t.status?(this.menuActive&&this.menuActive.setActive(!1),this.menuActive=t.target):this.menuActive===t.target&&(this.menuActive=null)},_findMenu:function(t){return _.findWhere(this.menus,{id:t})},_createMenu:function(t){var e=e instanceof i?e:new i(t);return e.on("active",this.onActive,this),e}});e.exports=o},{"./menu":24}],24:[function(t,e,n){var i=(app.events,t("./button")),o=t("./popover");e.exports=L.Class.extend({includes:L.Mixin.Events,initialize:function(t){this.id=t.id,this.isActive=!1,this.button=new i(_.omit(t,"popover")),t.popover&&(this.popover=new o(this.button.el,t.popover).on("open",this.onOpen,this).on("close",this.onClose,this)),this.button.on("add",this.onAdd,this).on("click",this.onClick,this)},onOpen:function(){this.isActive=!0,this.fire("active",{status:!0})},onClose:function(){this.isActive=!1,this.fire("active",{status:!1})},onClick:function(t){this.setActive()},onAdd:function(t){this.popover._map=t.map,this.popover._mover()},setActive:function(t){var e=void 0===t?!this.isActive:t;return this.popover&&this.popover[e?"show":"hide"](),this}})},{"./button":21,"./popover":25}],25:[function(t,e,n){var i=(app.events.channel("screen"),L.Class.extend({options:{content:"test"},includes:L.Mixin.Events,initialize:function(t,e){this.target=t,this.$target=$(t),L.Util.setOptions(this,e),this.options.view&&(this.options.content=this.options.view.el),this._create(this.options)},isOpen:function(){return!!this.$target.attr("aria-describedby")},show:function(){this.$target.popover("show")},hide:function(){this.$target.popover("hide")},toggle:function(){this.$target.popover("toggle")},_create:function(t){this._popover=this.$target.menuPopover(t).on("show.bs.popover hide.bs.popover",function(t){this.fire("show"===t.type?"open":"close")}.bind(this)).data("bs.popover")},_mover:function(t){this._map.on("resize",function(t){this.isOpen()&&this._popover.mover()}.bind(this))}}));e.exports=i},{}],26:[function(t,e,n){L.Control.Locate=L.Control.extend({options:{position:"bottomleft",className:"map-locate icon-location"},includes:L.Mixin.Events,initialize:function(t){L.Control.prototype.initialize.apply(this,arguments)},onAdd:function(t){this._map=t;var e=this.el=L.DomUtil.create("div",this.options.className),n=L.DomEvent.stopPropagation;return L.DomEvent.on(e,"contextmenu",n).on(e,"contextmenu",L.DomEvent.preventDefault).on(e,"click",n).on(e,"mousedown",n).on(e,"dblclick",n).on(e,"click",L.DomEvent.preventDefault).on(e,"click",this.onClick,this).on(e,"click",this._refocusOnMap,this),this.$el=$(e).attr({id:this.options.id,title:this.options.title}),this.options.icon&&this.$el.append(this.options.icon),t.on("locationfound",this.onLocationFound,this).on("locationerror",this.onLocationError,this),e},onClick:function(t){this._map.locate()},onLocationFound:function(t){this._map.setView(t.latlng),this.fire("location",t);var e=L.marker(t.latlng,{icon:app.options.icons.df}).addTo(this._map);setTimeout(function(){this._map.removeLayer(e)}.bind(this),3e3)},onLocationError:function(t){console.log(t)}}),L.control.locate=function(){return new L.Control.Locate}},{}],27:[function(t,e,n){L.Control.MousePosition=L.Control.extend({options:{position:"bottomleft",separator:" : ",emptyString:"Unavailable",lngFirst:!1,numDigits:5,lngFormatter:void 0,latFormatter:void 0,prefix:""},onAdd:function(t){var e=this._container=L.DomUtil.create("div","leaflet-control-mouseposition");return L.DomEvent.on(e,"contextmenu",L.DomEvent.stopPropagation).on(e,"contextmenu",L.DomEvent.preventDefault),L.DomEvent.disableClickPropagation(this._container),t.on("mousemove",this._onMouseMove,this),this._container.innerHTML=this.options.emptyString,this._container},onRemove:function(t){t.off("mousemove",this._onMouseMove)},_onMouseMove:function(t){var e=this.options.lngFormatter?this.options.lngFormatter(t.latlng.lng):L.Util.formatNum(t.latlng.lng,this.options.numDigits),n=this.options.latFormatter?this.options.latFormatter(t.latlng.lat):L.Util.formatNum(t.latlng.lat,this.options.numDigits),i=this.options.lngFirst?e+this.options.separator+n:n+this.options.separator+e,o=this.options.prefix+" "+i;this._container.innerHTML=o}}),L.Map.mergeOptions({positionControl:!1}),L.Map.addInitHook(function(){this.options.positionControl&&(this.positionControl=new L.Control.MousePosition,this.addControl(this.positionControl))}),L.control.mousePosition=function(t){return new L.Control.MousePosition(t)}},{}],28:[function(t,e,n){"undefined"==typeof Number.prototype.toRadians&&(Number.prototype.toRadians=function(){return this*Math.PI/180}),"undefined"==typeof Number.prototype.toDegrees&&(Number.prototype.toDegrees=function(){return 180*this/Math.PI});var i=179.999;L.Geodesic=L.MultiPolyline.extend({options:{color:"blue",steps:10,dash:1,wrap:!0},initialize:function(t,e){this.options=this._merge_options(this.options,e),this.datum={},this.datum.ellipsoid={a:6378137,b:6356752.3142,f:1/298.257223563},L.MultiPolyline.prototype.initialize.call(this,t,this.options)},setLatLngs:function(t){this._latlngs=this.options.dash<1?this._generate_GeodesicDashed(t):this._generate_Geodesic(t),L.MultiPolyline.prototype.setLatLngs.call(this,this._latlngs)},getStats:function(){var t,e,n={distance:0,points:0,polygons:this._latlngs.length};for(t=0;t<this._latlngs.length;t++)for(n.points+=this._latlngs[t].length,e=0;e<this._latlngs[t].length-1;e++)n.distance+=this._vincenty_inverse(this._latlngs[t][e],this._latlngs[t][e+1]).distance;return n},createCircle:function(t,e){var n,o=[],s=0,r={lat:0,lng:0,brg:0};o[s]=[];var a=this._vincenty_direct(L.latLng(t),0,e,this.options.wrap);for(r=L.latLng(a.lat,a.lng),o[s].push(r),n=1;n<=this.options.steps;){a=this._vincenty_direct(L.latLng(t),360/this.options.steps*n,e,this.options.wrap);var l=L.latLng(a.lat,a.lng);if(Math.abs(l.lng-r.lng)>180){var u=this._vincenty_inverse(r,l),c=this._intersection(r,u.initialBearing,{lat:-89,lng:l.lng-r.lng>0?-i:i},0);c?(o[s].push(L.latLng(c.lat,c.lng)),s++,o[s]=[],r=L.latLng(c.lat,-c.lng),o[s].push(r)):(s++,o[s]=[],o[s].push(l),r=l,n++)}else o[s].push(l),r=l,n++}this._latlngs=o,L.MultiPolyline.prototype.setLatLngs.call(this,this._latlngs)},_generate_Geodesic:function(t){var e,n,o,s=[],r=0;for(n=0;n<t.length;n++){for(s[r]=[],o=0;o<t[n].length-1;o++){var a=this._vincenty_inverse(L.latLng(t[n][o]),L.latLng(t[n][o+1])),l=L.latLng(t[n][o]);for(s[r].push(l),e=1;e<=this.options.steps;){var u=this._vincenty_direct(L.latLng(t[n][o]),a.initialBearing,a.distance/this.options.steps*e,this.options.wrap),c=L.latLng(u.lat,u.lng);if(Math.abs(c.lng-l.lng)>180){var h=this._intersection(L.latLng(t[n][o]),a.initialBearing,{lat:-89,lng:c.lng-l.lng>0?-i:i},0);h?(s[r].push(L.latLng(h.lat,h.lng)),r++,s[r]=[],l=L.latLng(h.lat,-h.lng),s[r].push(l)):(r++,s[r]=[],s[r].push(c),l=c,e++)}else s[r].push(c),l=c,e++}}r++}return s},_generate_GeodesicDashed:function(t){var e,n,o,s=[],r=0;for(n=0;n<t.length;n++){for(s[r]=[],o=0;o<t[n].length-1;o++){var a=this._vincenty_inverse(L.latLng(t[n][o]),L.latLng(t[n][o+1])),l=L.latLng(t[n][o]);for(s[r].push(l),e=1;e<=this.options.steps;){var u=this._vincenty_direct(L.latLng(t[n][o]),a.initialBearing,a.distance/this.options.steps*e-a.distance/this.options.steps*(1-this.options.dash),this.options.wrap),c=L.latLng(u.lat,u.lng);if(Math.abs(c.lng-l.lng)>180){var h=this._intersection(L.latLng(t[n][o]),a.initialBearing,{lat:-89,lng:c.lng-l.lng>0?-i:i},0);h?(s[r].push(L.latLng(h.lat,h.lng)),r++,s[r]=[],l=L.latLng(h.lat,-h.lng),s[r].push(l)):(r++,s[r]=[],s[r].push(c),l=c,e++)}else{s[r].push(c),r++;var d=this._vincenty_direct(L.latLng(t[n][o]),a.initialBearing,a.distance/this.options.steps*e,this.options.wrap);s[r]=[],s[r].push(L.latLng(d.lat,d.lng)),e++}}}r++}return s},_vincenty_direct:function(t,e,n,i){var o,s=t.lat.toRadians(),r=t.lng.toRadians(),a=e.toRadians(),l=n,u=this.datum.ellipsoid.a,c=this.datum.ellipsoid.b,h=this.datum.ellipsoid.f,d=Math.sin(a),p=Math.cos(a),f=(1-h)*Math.tan(s),m=1/Math.sqrt(1+f*f),g=f*m,v=Math.atan2(f,p),_=m*d,y=1-_*_,b=y*(u*u-c*c)/(c*c),w=1+b/16384*(4096+b*(-768+b*(320-175*b))),M=b/1024*(256+b*(-128+b*(74-47*b))),L=l/(c*w),k=0;do{var x=Math.cos(2*v+L),D=Math.sin(L),S=Math.cos(L),T=M*D*(x+M/4*(S*(-1+2*x*x)-M/6*x*(-3+4*D*D)*(-3+4*x*x)));o=L,L=l/(c*w)+T}while(Math.abs(L-o)>1e-12&&++k);var C=g*D-m*S*p,P=Math.atan2(g*S+m*D*p,(1-h)*Math.sqrt(_*_+C*C)),O=Math.atan2(D*d,m*S-g*D*p),A=h/16*y*(4+h*(4-3*y)),E=O-(1-A)*h*_*(L+A*D*(x+A*S*(-1+2*x*x)));if(i)var z=(r+E+3*Math.PI)%(2*Math.PI)-Math.PI;else var z=r+E;var Y=Math.atan2(_,-C);return{lat:P.toDegrees(),lng:z.toDegrees(),finalBearing:Y.toDegrees()}},_vincenty_inverse:function(t,e){var n,i=t.lat.toRadians(),o=t.lng.toRadians(),s=e.lat.toRadians(),r=e.lng.toRadians(),a=this.datum.ellipsoid.a,l=this.datum.ellipsoid.b,u=this.datum.ellipsoid.f,c=r-o,h=(1-u)*Math.tan(i),d=1/Math.sqrt(1+h*h),p=h*d,f=(1-u)*Math.tan(s),m=1/Math.sqrt(1+f*f),g=f*m,v=c,_=0;do{var y=Math.sin(v),b=Math.cos(v),w=m*y*(m*y)+(d*g-p*m*b)*(d*g-p*m*b),M=Math.sqrt(w);if(0==M)return 0;var L=p*g+d*m*b,k=Math.atan2(M,L),x=d*m*y/M,D=1-x*x,S=L-2*p*g/D;isNaN(S)&&(S=0);var T=u/16*D*(4+u*(4-3*D));n=v,v=c+(1-T)*u*x*(k+T*M*(S+T*L*(-1+2*S*S)))}while(Math.abs(v-n)>1e-12&&++_<100);if(_>=100)return console.log("Formula failed to converge. Altering target position."),this._vincenty_inverse(t,{lat:e.lat,lng:e.lng-.01});var C=D*(a*a-l*l)/(l*l),P=1+C/16384*(4096+C*(-768+C*(320-175*C))),O=C/1024*(256+C*(-128+C*(74-47*C))),A=O*M*(S+O/4*(L*(-1+2*S*S)-O/6*S*(-3+4*M*M)*(-3+4*S*S))),E=l*P*(k-A),z=Math.atan2(m*y,d*g-p*m*b),Y=Math.atan2(d*y,-p*m+d*g*b);return E=Number(E.toFixed(3)),{distance:E,initialBearing:z.toDegrees(),finalBearing:Y.toDegrees()}},_intersection:function(t,e,n,i){var o=t.lat.toRadians(),s=t.lng.toRadians(),r=n.lat.toRadians(),a=n.lng.toRadians(),l=Number(e).toRadians(),u=Number(i).toRadians(),c=r-o,h=a-s,d=2*Math.asin(Math.sqrt(Math.sin(c/2)*Math.sin(c/2)+Math.cos(o)*Math.cos(r)*Math.sin(h/2)*Math.sin(h/2)));if(0==d)return null;var p=Math.acos((Math.sin(r)-Math.sin(o)*Math.cos(d))/(Math.sin(d)*Math.cos(o)));isNaN(p)&&(p=0);var f=Math.acos((Math.sin(o)-Math.sin(r)*Math.cos(d))/(Math.sin(d)*Math.cos(r)));if(Math.sin(a-s)>0)var m=p,g=2*Math.PI-f;else var m=2*Math.PI-p,g=f;var v=(l-m+Math.PI)%(2*Math.PI)-Math.PI,_=(g-u+Math.PI)%(2*Math.PI)-Math.PI;if(0==Math.sin(v)&&0==Math.sin(_))return null;if(Math.sin(v)*Math.sin(_)<0)return null;var y=Math.acos(-Math.cos(v)*Math.cos(_)+Math.sin(v)*Math.sin(_)*Math.cos(d)),b=Math.atan2(Math.sin(d)*Math.sin(v)*Math.sin(_),Math.cos(_)+Math.cos(v)*Math.cos(y)),w=Math.asin(Math.sin(o)*Math.cos(b)+Math.cos(o)*Math.sin(b)*Math.cos(l)),M=Math.atan2(Math.sin(l)*Math.sin(b)*Math.cos(o),Math.cos(b)-Math.sin(o)*Math.sin(w)),L=s+M;return L=(L+3*Math.PI)%(2*Math.PI)-Math.PI,{lat:w.toDegrees(),lng:L.toDegrees()}},_merge_options:function(t,e){var n={};for(var i in t)n[i]=t[i];for(var i in e)n[i]=e[i];return n}}),L.geodesic=function(t,e){return new L.Geodesic(t,e)},function(){var t=L.GeoJSON.geometryToLayer;L.GeoJSON.geometryToLayer=function(e,n,i,o){if(e.properties&&e.properties.geodesic){var s,r="Feature"===e.type?e.geometry:e,a=r.coordinates,l=e.properties;switch(i=i||this.coordsToLatLng,l.geodesic_steps&&(o=L.extend({steps:l.geodesic_steps},o)),l.geodesic_wrap&&(o=L.extend({wrap:l.geodesic_wrap},o)),r.type){case"LineString":return s=this.coordsToLatLngs(a,0,i),new L.Geodesic([s],o);case"MultiLineString":return s=this.coordsToLatLngs(a,1,i),new L.Geodesic(s,o);default:console.log("Not yet supported drawing GeoJSON "+r.type+" as a geodesic: Drawing as non-geodesic.")}}return t.apply(this,arguments)}}()},{}],29:[function(t,e,n){!function(t){t(_,Backbone,{})}(function(t,e,n){e.Stickit=n,n._handlers=[],n.addHandler=function(e){e=t.map(t.flatten([e]),function(e){return t.defaults({},e,{updateModel:!0,updateView:!0,updateMethod:"text"})}),this._handlers=this._handlers.concat(e)},n.ViewMixin={_modelBindings:null,unstickit:function(e,n){if(t.isObject(n))return void t.each(n,function(t,n){this.unstickit(e,n)},this);var i=[],o=[];this._modelBindings=t.reject(this._modelBindings,function(t){return e&&t.model!==e||n&&t.config.selector!=n?void 0:(t.model.off(t.event,t.fn),o.push(t.config._destroy),i.push(t.model),!0)}),t.invoke(t.uniq(i),"trigger","stickit:unstuck",this.cid),t.each(t.uniq(o),function(t){t.call(this)},this),this.$el.off(".stickit"+(e?"."+e.cid:""),n)},stickit:function(e,n){var i=e||this.model,o=n||t.result(this,"bindings")||{};this._modelBindings||(this._modelBindings=[]),this.addBinding(i,o);var s=this.remove;return s.stickitWrapped||(this.remove=function(){var t=this;return this.unstickit(),s&&(t=s.apply(this,arguments)),t}),this.remove.stickitWrapped=!0,this},addBinding:function(e,n,o){var m=e||this.model,g=".stickit."+m.cid;if(o=o||{},t.isObject(n)){var v=n;return void t.each(v,function(t,e){this.addBinding(m,e,t)},this)}var _=":el"===n?this.$el:this.$(n);if(this.unstickit(m,n),_.length){t.isString(o)&&(o={observe:o}),t.isFunction(o.observe)&&(o.observe=o.observe.call(this));var y=c(_,o),b=y.observe;y.selector=n,y.view=this;var w=y.bindId=t.uniqueId(),M=t.extend({stickitChange:y},y.setOptions);if(y._destroy=function(){s.call(this,y.destroy,_,m,y)},h(_,y,m,b),p(_,y,m,b),d(_,y,m,b),b){t.each(y.events,function(e){var o=e+g,a=function(t){var e=s.call(this,y.getVal,_,t,y,i.call(arguments,1)),n=r(y.updateModel,e,t,y);n&&l(m,b,e,M,y)},u=":el"===n?"":n;this.$el.on(o,u,t.bind(a,this))},this),t.each(t.flatten([b]),function(t){a(m,"change:"+t,y,function(t,e,n){var i=n&&n.stickitChange&&n.stickitChange.bindId;if(i!==w){var o=u(m,b,y);f(_,y,o,m)}})});var L=u(m,b,y);f(_,y,L,m,!0)}s.call(this,y.initialize,_,m,y)}}},t.extend(e.View.prototype,n.ViewMixin);
var i=[].slice,o=function(e,n){var i=(n||"").split("."),o=t.reduce(i,function(t,e){return t[e]},e);return null==o?e:o},s=function(e){return e=t.isString(e)?o(this,e):e,e?e.apply(this,i.call(arguments,1)):void 0},r=function(e,n,i){if(t.isBoolean(e))return e;if(t.isFunction(e)||t.isString(e)){var o=t.last(arguments).view;return s.apply(o,arguments)}return!1},a=function(t,e,n,i){var o=n.view;t.on(e,i,o),o._modelBindings.push({model:t,event:e,fn:i,config:n})},l=function(e,n,i,o,r){var a={},l=r.view;r.onSet&&(i=s.call(l,r.onSet,i,r)),r.set?s.call(l,r.set,n,i,o,r):(a[n]=i,t.isArray(n)&&t.isArray(i)&&(a=t.reduce(n,function(e,n,o){return e[n]=t.has(i,o)?i[o]:null,e},{})),e.set(a,o))},u=function(e,n,i){var o=i.view,r=function(t){return e[i.escape?"escape":"get"](t)},a=function(t){return null==t?"":t},l=t.isArray(n)?t.map(n,r):r(n);return i.onGet&&(l=s.call(o,i.onGet,l,i)),t.isArray(l)?t.map(l,a):a(l)},c=n.getConfiguration=function(e,i){var o=[{updateModel:!1,updateMethod:"text",update:function(t,e,n,i){t[i.updateMethod]&&t[i.updateMethod](e)},getVal:function(t,e,n){return t[n.updateMethod]()}}];o=o.concat(t.filter(n._handlers,function(t){return e.is(t.selector)})),o.push(i);var s=t.extend.apply(t,o);return t.has(s,"updateView")||(s.updateView=!s.visible),s},h=function(e,n,i,o){var s=["autofocus","autoplay","async","checked","controls","defer","disabled","hidden","indeterminate","loop","multiple","open","readonly","required","scoped","selected"],r=n.view;t.each(n.attributes||[],function(l){l=t.clone(l),l.view=r;var c="",h=l.observe||(l.observe=o),d=function(){var n=t.contains(s,l.name)?"prop":"attr",o=u(i,h,l);"class"===l.name?(e.removeClass(c).addClass(o),c=o):e[n](l.name,o)};t.each(t.flatten([h]),function(t){a(i,"change:"+t,n,d)}),d()})},d=function(e,n,i,o){t.each(n.classes||[],function(o,s){t.isString(o)&&(o={observe:o}),o.view=n.view;var r=o.observe,l=function(){var t=u(i,r,o);e.toggleClass(s,!!t)};t.each(t.flatten([r]),function(t){a(i,"change:"+t,n,l)}),l()})},p=function(e,n,i,o){if(null!=n.visible){var r=n.view,l=function(){var a=n.visible,l=n.visibleFn,c=u(i,o,n),h=!!c;(t.isFunction(a)||t.isString(a))&&(h=!!s.call(r,a,c,n)),l?s.call(r,l,e,h,n):e.toggle(h)};t.each(t.flatten([o]),function(t){a(i,"change:"+t,n,l)}),l()}},f=function(t,e,n,i,o){var a=e.view;r(e.updateView,n,e)&&(s.call(a,e.update,t,n,i,e),o||s.call(a,e.afterUpdate,t,n,e))};return n.addHandler([{selector:"[contenteditable]",updateMethod:"html",events:["input","change"]},{selector:"input",events:["propertychange","input","change"],update:function(t,e){t.val(e)},getVal:function(t){return t.val()}},{selector:"textarea",events:["propertychange","input","change"],update:function(t,e){t.val(e)},getVal:function(t){return t.val()}},{selector:'input[type="radio"]',events:["change"],update:function(t,e){t.filter('[value="'+e+'"]').prop("checked",!0)},getVal:function(t){return t.filter(":checked").val()}},{selector:'input[type="checkbox"]',events:["change"],update:function(n,i,o,s){if(n.length>1)i||(i=[]),n.each(function(n,o){var s=e.$(o),r=t.contains(i,s.val());s.prop("checked",r)});else{var r=t.isBoolean(i)?i:i===n.val();n.prop("checked",r)}},getVal:function(n){var i;if(n.length>1)i=t.reduce(n,function(t,n){var i=e.$(n);return i.prop("checked")&&t.push(i.val()),t},[]);else{i=n.prop("checked");var o=n.val();"on"!==o&&null!=o&&(i=i?n.val():null)}return i}},{selector:"select",events:["change"],update:function(n,i,r,a){var l,c=a.selectOptions,h=c&&c.collection||void 0,d=n.prop("multiple");if(!c){c={};var p=function(t){return t.map(function(t,n){var i=e.$(n).data("stickit-bind-val");return{value:void 0!==i?i:n.value,label:n.text}}).get()};n.find("optgroup").length?(h={opt_labels:[]},n.find("> option").length&&(h.opt_labels.push(void 0),t.each(n.find("> option"),function(t){h[void 0]=p(e.$(t))})),t.each(n.find("optgroup"),function(t){var n=e.$(t).attr("label");h.opt_labels.push(n),h[n]=p(e.$(t).find("option"))})):h=p(n.find("option"))}c.valuePath=c.valuePath||"value",c.labelPath=c.labelPath||"label",c.disabledPath=c.disabledPath||"disabled";var f=function(n,i,s){t.each(n,function(n){var r,a,l,u=e.$("<option/>"),h=n,p=function(e,n,i){u.text(e),h=n,u.data("stickit-bind-val",h),t.isArray(h)||t.isObject(h)||u.val(h),i===!0&&u.prop("disabled","disabled")};"__default__"===n?(r=s.label,a=s.value,l=s.disabled):(r=o(n,c.labelPath),a=o(n,c.valuePath),l=o(n,c.disabledPath)),p(r,a,l);var f=function(){return d||null==h||null==s||h!==s?t.isObject(s)&&t.isEqual(h,s)?!0:!1:!0};f()?u.prop("selected",!0):d&&t.isArray(s)&&t.each(s,function(e){t.isObject(e)&&(e=o(e,c.valuePath)),(e===h||t.isObject(e)&&t.isEqual(h,e))&&u.prop("selected",!0)}),i.append(u)})};if(n.find("*").remove(),t.isString(h)){var m=window;0===h.indexOf("this.")&&(m=this),h=h.replace(/^[a-z]*\.(.+)$/,"$1"),l=o(m,h)}else l=t.isFunction(h)?s.call(this,h,n,a):h;if(l instanceof e.Collection){var g=l,v=function(){var t=u(r,a.observe,a);s.call(this,a.update,n,t,r,a)},_=function(){g.off("add remove reset sort",v)},y=function(){_(),g.off("stickit:selectRefresh"),r.off("stickit:selectRefresh")};g.trigger("stickit:selectRefresh"),g.once("stickit:selectRefresh",_,this),g.on("add remove reset sort",v,this),r.trigger("stickit:selectRefresh"),r.once("stickit:selectRefresh",function(){r.off("stickit:unstuck",y)}),r.once("stickit:unstuck",y,this),l=l.toJSON()}if(c.defaultOption){var b=t.isFunction(c.defaultOption)?c.defaultOption.call(this,n,a):c.defaultOption;f(["__default__"],n,b)}if(t.isArray(l))f(l,n,i);else if(l.opt_labels)t.each(l.opt_labels,function(t){var o=e.$("<optgroup/>").attr("label",t);f(l[t],o,i),n.append(o)});else{var w,M=[];for(var L in l)w={},w[c.valuePath]=L,w[c.labelPath]=l[L],M.push(w);M=t.sortBy(M,c.comparator||c.labelPath),f(M,n,i)}},getVal:function(n){var i=n.find("option:selected");return n.prop("multiple")?t.map(i,function(t){return e.$(t).data("stickit-bind-val")}):i.data("stickit-bind-val")}}]),n})},{}],30:[function(t,e,n){t("./L.Control.MousePosition"),t("./L.Control.Locate"),t("./L.Geodesic"),t("./backbone.stickit")},{"./L.Control.Locate":26,"./L.Control.MousePosition":27,"./L.Geodesic":28,"./backbone.stickit":29}],31:[function(t,e,n){var i=Backbone.View.extend({events:function(){return{"click [data-command]":"_onCommand"}},_onCommand:function(t){var e=$(t.currentTarget),n=e.data("command");return this[n]?this[n](t):(t.preventDefault(),void alert("Command ["+n+"] not default !!! "))}});e.exports=i},{}],32:[function(t,e,n){var i=L.Popup.extend({options:{maxWidth:800,autoPanPadding:L.point(20,70),htmlWait:$("#temp-info-wait").html()},initialize:function(t){i.__super__.initialize.apply(this,arguments),t.latlng&&this.setLatLng(t.latlng),t.content?this.setContent(t.content):this.options.htmlWait&&this._wait(this.options.htmlWait)},setContent:function(t){return t instanceof Backbone.View&&(t=t.el),$(this._container).show(),i.__super__.setContent.call(this,t)},reContent:function(t){return this.setContent(t),this.update(),this},_wait:function(t){return this.setContent(t),this}});e.exports=i},{}],33:[function(t,e,n){var i=t("../mask"),o={Model:{remoteField:"remoteErr",remoteValidate:function(t){var e=this.toJSON();e[this.remoteField]=t,this.validate(e)},messageError:function(t){return t.responseJSON&&t.responseJSON.message?t.responseJSON.message:L.Util.template("Error: {status}. {statusText}",t)}},View:{onRequest:function(){this._mask().start()},onSync:function(){this._mask().end()},onError:function(t,e,n){this._mask().end(500,function(){this.model.remoteValidate(e)},this)},_maskSelector:function(){},_mask:function(){return this.__mask||(this.__mask=new i({el:this._maskSelector()})),this.__mask},_setRemoteEvents:function(){this.model.on("error",this.onError,this),this.model.on("sync",this.onSync,this),this.model.on("request",this.onRequest,this)}}};e.exports=o},{"../mask":20}],34:[function(t,e,n){var i=t("./command"),o=i.extend({el:$("#temp-tabs-simple").html(),$tabs:function(t){var e=this.$("ul.nav.nav-tabs li a");return _.isNumber(t)?e.eq(t):e},$tabContent:function(t){return this.$($(t).attr("href"))}});e.exports=o},{"./command":31}],35:[function(t,e,n){var i=t("../../libs/footer"),o=i.extend({initialize:function(t){o.__super__.initialize.apply(this,arguments),this.on("all",this.onEvents,this)},onEvents:function(t,e){~["open","close","resize"].indexOf(t)&&app.events.channel("screen").trigger("footer:"+t,e)}}),s=L.Class.extend({initialize:function(t,e){this.active=null,this.footers=t.map(this._create,this)},onOpen:function(t,e){this.active&&this.active!==e&&this.active.close(!0),this.active=e},_create:function(t){var e=new o(t);e.on("open",this.onOpen,this)}});new s([{keyPress:"1",height:50,minHeight:10,maxHeight:70},{content:$("<div/>",{id:"CNT-90",title:"Become a Googler",text:"установим еще один обработчик события keypress, на этот раз элементам "}),keyPress:"2",height:20,minHeight:10,maxHeight:70},{content:$("#temp-footer-print").html(),keyPress:"3",height:100,minHeight:80,maxHeight:101}])},{"../../libs/footer":14}],36:[function(t,e,n){t("./map"),t("./menu"),t("./maps"),t("./footers"),t("./layers"),t("./route"),t("./info")},{"./footers":35,"./info":37,"./layers":41,"./map":49,"./maps":50,"./menu":57,"./route":75}],37:[function(t,e,n){var i=app.events.channel("info");i.on("map",t("./meteogram"),this),i.on("route:vertex",t("./route-vertex"),this)},{"./meteogram":38,"./route-vertex":39}],38:[function(t,e,n){var i=t("../../libs/views/popup"),o=(t("../../libs/views/tabs"),Backbone.View.extend({urlTemp:"http://openportguide.org/cgi-bin/weather/weather.pl/weather.png?var=meteogram&nx={w}&ny={h}&lat={lat}&lon={lng}&lang=ru&unit=metric&label={title}",template:_.template($("#temp-info-meteogram").html()),initialize:function(t){this.url=L.Util.template(this.urlTemp,t),t.h=800,t.w=800,this.url_full=L.Util.template(this.urlTemp,t),this.def=$.Deferred(),this.$el.append(this.template({url:this.url_full}))},load:function(){var t=$("<img />").attr("src",this.url).on("load",function(e){e.target.complete&&"undefined"!=typeof e.target.naturalWidth&&0!=e.target.naturalWidth?(this.$("a").append(t),this.def.resolve()):this.def.reject()}.bind(this));return this.def}}));e.exports=function(t){var e=new i({latlng:t.latlng}).openOn(app.map),n=($(window),new o({lat:t.latlng.lat,lng:t.latlng.lng,title:"sea map",w:400,h:500}));n.load().done(function(){e.reContent(n)}).fail(function(t){e.reContent(L.Util.template("Error:{status}. {statusText}",t))})}},{"../../libs/views/popup":32,"../../libs/views/tabs":34}],39:[function(t,e,n){var i=t("../../libs/views/popup"),o=t("../../libs/views/command"),s=o.extend({template:_.template($("#temp-info-route-vertex").html()),initialize:function(){this.render()},cmdTest:function(t){return alert(),!1},render:function(){this.$el.append(this.template({json:JSON.stringify(this.model.toJSON(),null,4)}))}});e.exports=function(t){new i({latlng:t.latlng,content:new s({model:t.model})}).openOn(app.map)}},{"../../libs/views/command":31,"../../libs/views/popup":32}],40:[function(t,e,n){var i=L.TileLayer.extend({options:{},initialize:function(t){this.url=t.urlTempl.replace("{t}","5"),i.__super__.initialize.call(this,this.url,t),app.events.channel("layers").on("meteotime",this.onTime,this)},getType:function(){return this.options.type},onTime:function(t){this.setUrl(this.options.urlTempl.replace("{t}",t))}});e.exports=i},{}],41:[function(t,e,n){var i=t("../../libs/layer"),o=t("./see-marker"),s=t("./base-meteo"),r=app.events.channel("layers"),a=i.extend({initialize:function(t){a.__super__.initialize.apply(this,arguments),r.on("active",this.onActive,this)}}),l=app.map,u=new a([t("./marine"),t("./ligth"),new o,new s({type:"WIND",urlTempl:"http://www.openportguide.org/tiles/actual/wind_vector/{t}/{z}/{x}/{y}.png"}),new s({type:"PRESS",urlTempl:"http://www.openportguide.org/tiles/actual/surface_pressure/{t}/{z}/{x}/{y}.png"}),new s({type:"TEMP",urlTempl:"http://www.openportguide.org/tiles/actual/air_temperature/{t}/{z}/{x}/{y}.png"}),new s({type:"PRECIPITATION",urlTempl:"http://www.openportguide.org/tiles/actual/precipitation/{t}/{z}/{x}/{y}.png"}),new s({type:"WAVE",urlTempl:"http://www.openportguide.org/tiles/actual/significant_wave_height/{t}/{z}/{x}/{y}.png"})]);u.addTo(l)},{"../../libs/layer":17,"./base-meteo":40,"./ligth":43,"./marine":46,"./see-marker":48}],42:[function(t,e,n){var i=t("../../../libs/layer/collection"),o=t("../../../libs/layer/model"),s=(t("osmtogeojson"),o.extend({coordName:"latlng",isBounds:function(t){return t.contains(this.get(this.coordName))},parse:function(t){return{id:t.id,latlng:new L.latLng(t.position),title:t.title,site:t.website}}})),r=i.extend({nameObj:"ligth",model:s,url:"/api/marina",initialize:function(t){r.__super__.initialize.apply(this,arguments)},load:function(){var t={bounds:app.map.getBounds().toBBoxString()};return this.fetch({data:t,reset:!0})}});e.exports=r},{"../../../libs/layer/collection":16,"../../../libs/layer/model":18,osmtogeojson:84}],43:[function(t,e,n){var i=t("./collection"),o=t("./view");e.exports=new o(new i({type:"LIGTH"}))},{"./collection":42,"./view":44}],44:[function(t,e,n){"use strict";var i=t("../../../libs/layer/view"),o=24,s=L.Marker.extend({initialize:function(t,e){this.model=t,s.__super__.initialize.call(this,t.get(t.coordName),e)},onAdd:function(t){s.__super__.onAdd.apply(this,arguments),this.on("click",this.onClick,this)},onRemove:function(){this.off("click",this.onClick,this),s.__super__.onRemove.apply(this,arguments)},onClick:function(t){window.open(this.model.get("site"),"_blank")}}),r=i.extend({_debug:!1,options:{layer:function(t){return{title:t.get("title"),icon:L.divIcon({iconSize:L.point(o,o),iconAnchor:L.point(o/2,o/2),className:"icon-marina_"+o+" map-see-icon-marine"})}}},onAdd:function(t){i.__super__.onAdd.apply(this,arguments),setTimeout(function(){this._map.on("moveend",this.onRefresh,this)}.bind(this)),this.collection.load(this._getParams()).done(this.render.bind(this)).fail(this.onError.bind(this))},onError:function(t){t.status>0&&app.message.send({className:"alert-danger",title:"Error",content:L.Util.template("<p>Код ошибки:<code>{status}</code>. {statusText}</p>",t),time:6e3,animation:0})},onRefresh:function(){this.collection.load(this._getParams()).done(this.render.bind(this)).fail(this.onError.bind(this))},create:function(t){var e=new s(t,this.options.layer(t));this.addLayer(e)},_getParams:function(){var t=this._map.getBounds();return{s:t.getSouth(),n:t.getNorth(),w:t.getWest(),e:t.getEast(),z:this._map.getZoom()}}});e.exports=r},{"../../../libs/layer/view":19}],45:[function(t,e,n){var i=t("../../../libs/layer/collection"),o=t("../../../libs/layer/model"),s=o.extend({coordName:"latlng",isBounds:function(t){return t.contains(this.get(this.coordName))}}),r=i.extend({url:"http://dev.openseamap.org/website/map/api/getHarbours.php?b={b}&t={t}&l={l}&r={r}&ucid=7&maxSize=6&zoom={z}",nameObj:"see",model:s,initialize:function(t){r.__super__.initialize.apply(this,arguments),window.putHarbourMarker=this._load.bind(this)},load:function(t){var e=L.Util.template(this.url,t);return this.reset(),this.ready=$.getScript(e,function(t,e,n){}.bind(this))},_load:function(t,e,n,i,o,s){var r=new this.model({id:t,latlng:L.latLng(n,e),title:i,site:o});this.add(r)}});e.exports=r},{"../../../libs/layer/collection":16,"../../../libs/layer/model":18}],46:[function(t,e,n){var i=t("./collection"),o=t("./view");e.exports=new o(new i({type:"MARINE"}))},{"./collection":45,"./view":47}],47:[function(t,e,n){"use strict";var i=t("../../../libs/layer/view"),o=24,s=L.Marker.extend({initialize:function(t,e){this.model=t,s.__super__.initialize.call(this,t.get(t.coordName),e)},onAdd:function(t){s.__super__.onAdd.apply(this,arguments),this.on("click",this.onClick,this)},onRemove:function(){this.off("click",this.onClick,this),s.__super__.onRemove.apply(this,arguments)},onClick:function(t){window.open(this.model.get("site"),"_blank")}}),r=i.extend({_debug:!1,options:{layer:function(t){return{title:t.get("title"),icon:L.divIcon({iconSize:L.point(o,o),iconAnchor:L.point(o/2,o/2),className:"icon-marina_"+o+" map-see-icon-marine",html:L.Util.template($("#temp-see-icon-marine").html(),_.extend({size:o},t.toJSON()))})}}},onAdd:function(t){i.__super__.onAdd.apply(this,arguments),setTimeout(function(){this._map.on("moveend",this.onRefresh,this)}.bind(this)),this.collection.load(this._getParams()).done(this.render.bind(this))},onRefresh:function(){this.collection.load(this._getParams()).done(this.render.bind(this))},create:function(t){var e=new s(t,this.options.layer(t));this.addLayer(e)},_getParams:function(){var t=this._map.getBounds();return{b:t.getSouth(),t:t.getNorth(),l:t.getWest(),r:t.getEast(),z:this._map.getZoom()}}});e.exports=r},{"../../../libs/layer/view":19}],48:[function(t,e,n){var i=L.TileLayer.extend({options:{},url:"http://tiles.openseamap.org/seamark/{z}/{x}/{y}.png",initialize:function(t,e){i.__super__.initialize.call(this,this.url,e)},getType:function(){return"SEEMARKER"}});e.exports=i},{}],49:[function(t,e,n){var i=app.events,o=Backbone.View.extend({initialize:function(t){i.channel("screen").on("footer:open footer:close footer:resize",this.onFooter,this),i.channel("system").on("unload",this.onUnload,this).on("load",this.onLoad,this),app.map=this.map=this.initMap(t),this.initControls(),this.initEvent()},initMap:function(t){var e=L.map(this.el,t.map).setView(t.position,t.zoom);return e},initControls:function(){L.control.zoom({position:"bottomright"}).addTo(this.map),L.control.mousePosition().addTo(this.map),L.control.locate({title:"Определить местоположение..."}).on("location",this.onLocation,this).addTo(this.map)},initEvent:function(){this.map.on("contextmenu",this.onContextmenu,this),this.map.on("click",this.onClick,this)},capture:function(t,e,n){var i=_.values(this.map._layers);return t=[].concat(t),i.filter(function(e){return e.capture&&e.types&&_.intersection(t,e.types).length>0},this).map(function(i){return i.capture(t,e,n)},this).reduce(function(t,e){return t.concat(e)},[]).sort(function(t,e){return t.distance>e.distance})},onLocation:function(t){console.time("ttt"),_.values(this.map._layers).filter(function(t){return t.collection&&"zone"===t.collection.nameObj}).forEach(function(e){var n=e.getLayers().filter(function(e){return e.model.contains(t.latlng,e._map)}).map(function(t){return t.model.toJSON()});console.log(e.collection.type,n)}),console.timeEnd("ttt")},onClick:function(t){i.channel("info").trigger("map",t)},onContextmenu:function(t){i.channel("route").trigger("add",{latlng:t.latlng})},getState:function(){var t=this.map,e=t.getCenter();return{center:e,zoom:t.getZoom()}},onFooter:function(t){this.$el.css({height:100-t+"%"}),this.map.invalidateSize()},onUnload:function(){app.store.set("map-state",this.getState())},onLoad:function(){var t=app.store.get("map-state");this.map.setView(t.center,t.zoom)}}),s=app.store.get("map-state"),r=new o({el:$("#map"),map:{zoomControl:!1},position:s.center||[55.5,37.5],zoom:s.zoom||7});e.exports=r},{}],50:[function(t,e,n){var i=app.map,o=t("../../libs/layer"),s=t("./layer"),r=app.events.channel("base-map"),a=o.extend({initialize:function(t){a.__super__.initialize.apply(this,arguments),r.on("active",this.onActive,this)},onActive:function(t){this.clearLayers(),this.types[t]&&this.addLayer(this._active=this.types[t]),setTimeout(this._bringToBack.bind(this))},_bringToBack:function(){var t=this._map._panes.tilePane;return this._active&&this._active._container&&t.insertBefore(this._active._container,t.firstChild),this},_nextIndex:0,_nextType:function(){var t=_.keys(this.types);return this.types[t[++this._nextIndex]||t[this._nextIndex=0]]}}),l=new a([new s("http://{s}.tile.osm.org/{z}/{x}/{y}.png",{type:"OSM",attribution:'&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors'}),new s("http://{s}.tile.opencyclemap.org/cycle/{z}/{x}/{y}.png",{type:"OCM",attribution:'&copy; <a href="http://osm.org/copyright">OpenCycleMap</a> contributors'}),new s("http://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}.png",{type:"CRT",noWrap:!0,attribution:'&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, &copy; <a href="http://cartodb.com/attributions">CartoDB</a>'})]);l.addTo(i)},{"../../libs/layer":17,"./layer":51}],51:[function(t,e,n){var i=L.TileLayer.extend({getType:function(){return this.options.type}});e.exports=i},{}],52:[function(t,e,n){var i=t("./login"),o=(app.events.channel("auth"),i.Model.extend({urlRoot:function(){return"/api/auth/token/"+this.options.token},defaults:{username:"",password:"",password1:""},initialize:function(t,e){this.options=e},validation:{username:{required:!0,pattern:"email"},password:{required:!0,minLength:5,remoteErr400:{}},password1:{required:!0,minLength:5,fn:function(t,e,n){return t===n.password?null:"Пароль не совпадает"}},remoteErr:{remote:{fn:function(t,e){return 400===t.status?null:e.messageError(t)}}}}})),s=i.View.extend({el:$("#temp-password-change").html(),model:new o,bindings:{"[name=username]":"username","[name=password]":"password","[name=password1]":"password1"},onSync:function(){this._mask().end(300,function(){this.modal.close(),this._message()},this)},onError:function(t,e,n){this._mask().end(300,function(){this.model.remoteValidate(e)},this)},_message:function(){app.message.send({className:"alert-info",title:"Сброс пароля",content:L.Util.template("Пароль для пользователя <b>{username}</b> изменен.",this.model.toJSON()),time:1e4})},_maskSelector:function(){return this.$(".modal-content")}});e.exports=function(t){$.get("/api/auth/token/"+t).done(function(e,n){app.modal.open(new s({model:new o(e,{token:t})}))}).fail(function(e){app.message.send({className:"alert-danger",title:"Ошибка сброса пароля:",content:"["+t.slice(0,7)+"...] "+e.responseJSON.message,time:1e4})})}},{"./login":54}],53:[function(t,e,n){var i=t("../../../libs/views/command"),o=t("./login").View,s=t("./register"),r=t("./reset-password"),a=t("./change-password"),l=app.events.channel("auth"),u=i.extend({initialize:function(t){this.views={},this.setTabs(t.tabs),this.testLogin()},testLogin:function(){var t=this.views[".tab1"];$.get("/api/auth/login",function(e){t.model.set(e),t.onLogin()})},setTabs:function(t){for(var e in t){var n=t[e];this.views[e]=new n({el:this.$(e)})}},"switch":function(t){this.$("[class^=tab]").addClass("hide"),this.$(t).removeClass("hide").addClass("active")},cmdRegister:function(t){this["switch"](".tab2")},cmdLogin:function(t){this["switch"](".tab1")},cmdResetPassword:function(t){var e=r(this.views[".tab1"].model.get("username"));return app.modal.open(e),!1}});l.on("change-password",a),e.exports={position:"topright",id:"login",title:"Вход/регистрация в системе",icon:'<div class="icon-logout map-menu-button-icon"/>',popover:{view:new u({el:$("#temp-login-register").html(),tabs:{".tab1":o,".tab2":s}}),title:"Вход/регистрация в системе"}}},{"../../../libs/views/command":31,"./change-password":52,"./login":54,"./register":55,"./reset-password":56}],54:[function(t,e,n){var i=t("../../../libs/views/remote-mix"),o=app.events.channel("auth"),s=Backbone.Model.extend(i.Model),r=s.extend({idAttribute:"token",urlRoot:"/api/auth/login",defaults:{username:"",password:""},validation:{username:{required:!0,pattern:"email"},password:{required:!0,minLength:5,remoteErr400:{}},remoteErr:{remote:{fn:function(t,e){return 400===t.status?null:e.messageError(t)}}}}}),a=Backbone.View.extend(i.View),l=a.extend({model:new r,events:{submit:"onSubmit"},bindings:{"[name=username]":"username","[name=password]":"password"},initialize:function(t,e){Backbone.Validation.bind(this),this.stickit(),this._setRemoteEvents(),window.preLogin=this.onLoginNetwork.bind(this)},onSync:function(){this._mask().end(500,this.onLogin,this)},onError:function(t,e,n){this._mask().end(500,function(){this.model.remoteValidate(e),o.trigger("logout",{})},this)},onSubmit:function(t){t.preventDefault(),this.model.save()},onLogin:function(){o.trigger("login",this.model.toJSON()),this._message()},onLoginNetwork:function(t){$.get("/api/auth/login/token/"+t).done(function(t){this.model.set(t),this.onLogin()}.bind(this)).fail(function(t){app.message.send({className:"alert-info",title:"Инфо сообщение",content:this.model.messageError(t)})}.bind(this))},_message:function(){app.message.send({className:"alert-success",content:L.Util.template("Пользователь <b>{username}</b> успешно вошел в систему.",this.model.toJSON()),time:3400})},_maskSelector:function(){return this.$el.parents(".popover-content")}});e.exports={Model:r,View:l}},{"../../../libs/views/remote-mix":33}],55:[function(t,e,n){var i=t("./login"),o=i.Model.extend({urlRoot:"/api/auth/register",defaults:{username:"",password:"",password1:""},validation:{username:{required:!0,pattern:"email"},password:{required:!0,minLength:5,remoteErr400:{}},password1:{required:!0,minLength:5,fn:function(t,e,n){return t===n.password?null:"Пароль не совпадает"}},remoteErr:{remote:{fn:function(t,e){return 400===t.status?null:e.messageError(t)}}}},toJSON:function(){return _.omit(o.__super__.toJSON.apply(this,arguments),"password1")}}),s=i.View.extend({model:new o,bindings:{"[name=username]":"username","[name=password]":"password","[name=password1]":"password1"}});e.exports=s},{"./login":54}],56:[function(t,e,n){var i=t("./login"),o=i.Model.extend({urlRoot:"/api/auth/createToken",defaults:{username:""},validation:{username:{required:!0,pattern:"email"},remoteErr:{remote:{fn:function(t,e){return 400===t.status?null:e.messageError(t)}}}}}),s=i.View.extend({el:$("#temp-password-reset").html(),model:new o,events:{submit:"onSubmit"},bindings:{"[name=username]":"username"},onSync:function(){this._mask().end(300,function(){this.modal.close(),this._message()},this)},onError:function(t,e,n){this._mask().end(300,function(){this.model.remoteValidate(e)},this)},_message:function(){app.message.send({className:"alert-info",title:"Сброс пароля",content:L.Util.template('На Ваш email <b>{username}</b> отправленно сообщение. Для сброса пароля перейдите по <a href="/#token/{token}">ссылке</a> в письме.',this.model.toJSON()),time:2e4})},_maskSelector:function(){return this.$(".modal-content")}});e.exports=function(t){return new s({model:new o({username:t})})}},{"./login":54}],57:[function(t,e,n){"use strict";var i=app.events,o=t("../../libs/menu"),s=o.Manager.extend({initialize:function(){s.__super__.initialize.apply(this,arguments)},onActive:function(t){s.__super__.onActive.apply(this,arguments),app.events.channel("menu").trigger("active",t)}}),r=new s;r.add([t("./mera"),t("./maps"),t("./profile"),t("./auth"),t("./layers"),t("./meteo")]),i.channel("auth").on("login",function(t){r.setVisible("login",!1),r.setVisible("profile",!0)}),i.channel("auth").on("logout",function(t){r.setVisible("login",!0),r.setVisible("profile",!1)}),r.render(app.map)},{"../../libs/menu":22,"./auth":53,"./layers":58,"./maps":61,"./mera":64,"./meteo":66,"./profile":70}],58:[function(t,e,n){var i=t("./view");e.exports={position:"topcenter",id:"layers",icon:'<div  class="map-menu-button-icon icon-layers2"/>',popover:{view:new i,title:"Слои на карте"}}},{"./view":60}],59:[function(t,e,n){var i=app.options.layers,o=app.events,s=app.map,r=_.object(_.keys(i).map(function(t,e){return[t,!1]})),a=Backbone.Model.extend({nameStore:"layers-state",defaults:r,initialize:function(t,e){app.events.channel("system").on("unload",this.onUnload,this).on("load",this.onLoad,this)},onUnload:function(){app.store.set(this.nameStore,this.toJSON())},onLoad:function(){var t=app.store.get(this.nameStore);this.set(t)}}),l=Backbone.Model.extend({defaults:r,initialize:function(t,e){this.onZoom(),s.on("zoomend",this.onZoom,this)},onZoom:function(){var t=s.getZoom();_.keys(i).forEach(function(e){this.set(e,this.isLimitedZoom(e,t))},this)},isLimitedZoom:function(t,e){return i[t].enableZoom[0]<e&&i[t].enableZoom[1]>e}}),u=e.exports={checks:new a,limited:new l},c=Backbone.Model.extend({defaults:r,initialize:function(t,e){u.checks.on("change",this.onChecks,this),u.limited.on("change",this.onLimited,this),this.on("change",function(t){o.channel("layers").trigger("active",t.changed)})},onChecks:function(t){for(var e in t.changed)u.limited.get(e)&&this.set(e,t.get(e))},onLimited:function(t){for(var e in t.changed)this.set(e,t.get(e)&&u.checks.get(e))}});new c},{}],60:[function(t,e,n){var i=app.options.layers,o=Backbone.View.extend({template:_.template($("#temp-menu-layers").html()),model:t("./models").checks,limited:t("./models").limited,bindings:_.object(_.keys(i).map(function(t){return["#"+t,t]})),initialize:function(t,e){this.render(),this.stickit(),this.model.on("change",function(t){}),this.limited.on("change",this.onLimited,this)},render:function(){this.$el.append(this.template(i));for(var t in this.limited.toJSON())this.setLimited(t,this.limited.get(t))},onLimited:function(t){for(var e in t.changed)this.setLimited(e,t.get(e))},setLimited:function(t,e){this.$("#"+t).prop("disabled",!e).parent().toggleClass("map-air-space-limited",!e).attr("title",e?i[t].title:"ограничение zoom...")}});e.exports=o},{"./models":59}],61:[function(t,e,n){var i=t("./view");e.exports={position:"topright",id:"layers",icon:'<div  class="map-menu-button-icon icon-maps"/>',popover:{view:new i,title:"Переключение карт"}}},{"./view":63}],62:[function(t,e,n){var i=Backbone.Model.extend({defaults:{maps:"OSM"},nameStore:"maps-state",initialize:function(t,e){app.events.channel("system").on("unload",this.onUnload,this).on("load",this.onLoad,this)},onUnload:function(){app.store.set(this.nameStore,this.toJSON())},onLoad:function(){var t=app.store.get(this.nameStore);t&&this.set(t),this.setup()},setup:function(){app.events.channel("base-map").trigger("active",this.get("maps")),this.on("change",function(t){app.events.channel("base-map").trigger("active",this.get("maps"))},this)}});e.exports=i},{}],63:[function(t,e,n){var i=t("./model"),o=Backbone.View.extend({template:_.template($("#temp-menu-base-map").html()),model:new i,bindings:{"input[name=maps]":"maps"},initialize:function(t,e){this.render(),this.stickit()},render:function(){this.$el.append(this.template({}))}});e.exports=o},{"./model":62}],64:[function(t,e,n){var i=t("./view");e.exports={position:"topright",id:"mera",icon:'<div  class="map-menu-button-icon icon-mera"/>',popover:{view:new i,title:"Изменение расстояний"}}},{"./view":65}],65:[function(t,e,n){var i=app.map,o=L.FeatureGroup.extend({initialize:function(){o.__super__.initialize.call(this);i.getCenter();this.marker1=this._createMarker([0,0]),this.marker2=this._createMarker([0,0]),this.meraLine=L.polyline([],{weight:2,color:"#000",opacity:1,dashArray:[10,4]})},onAdd:function(){this.addLayer(this.marker1),this.addLayer(this.marker2),this.addLayer(this.meraLine),o.__super__.onAdd.apply(this,arguments)},onDrag:function(){this.meraLine.setLatLngs([this.marker1.getLatLng(),this.marker2.getLatLng()]),this.fire("drag",{distance:this.distance()})},distance:function(){return this.marker1.getLatLng().distanceTo(this.marker2.getLatLng())},reset:function(){var t=i.getCenter();return this.marker1.setLatLng(this._offset(t,-30)),this.marker2.setLatLng(this._offset(t,30)),this.onDrag(),this},_offset:function(t,e){var n=t.toPoint(i);return n.x+=e,n.toLatLng(i)},_createMarker:function(t){return L.marker(t,{icon:app.options.icons.df,draggable:!0}).on("drag",this.onDrag,this)}}),s=Backbone.View.extend({template:_.template($("#temp-menu-distance").html()),meraLine:new o,events:{"click button":"onReset"},initialize:function(t,e){this.render(),app.events.channel("menu").on("active",this.onActive,this),this.meraLine.on("drag",this.onDrag,this)},render:function(){return this.$el.append(this.template({})),this},onActive:function(t){"mera"===t.target.id&&(t.status?i.addLayer(this.meraLine.reset()):i.removeLayer(this.meraLine))},onReset:function(){this.meraLine.reset()},onDrag:function(t){this.$("h2").html((t.distance/1852).toFixed(2)+" nm.")}});e.exports=s},{}],66:[function(t,e,n){var i=t("./view");t("./wind-scale"),e.exports={position:"topcenter",id:"meteo",icon:'<div  class="map-menu-button-icon icon-meteo"/>',
popover:{view:new i,title:"Погода"}}},{"./view":68,"./wind-scale":69}],67:[function(t,e,n){var i=app.options.meteo,o=app.events,s=app.map,r=_.object(_.keys(i).map(function(t,e){return[t,!1]})),a=Backbone.Model.extend({nameStore:"meteo-state",defaults:r,initialize:function(t,e){app.events.channel("system").on("unload",this.onUnload,this).on("load",this.onLoad,this)},onUnload:function(){app.store.set(this.nameStore,this.toJSON())},onLoad:function(){var t=app.store.get(this.nameStore);this.set(t)}}),l=Backbone.Model.extend({defaults:r,initialize:function(t,e){this.onZoom(),s.on("zoomend",this.onZoom,this)},onZoom:function(){var t=s.getZoom();_.keys(i).forEach(function(e){this.set(e,this.isLimitedZoom(e,t))},this)},isLimitedZoom:function(t,e){return i[t].enableZoom[0]<e&&i[t].enableZoom[1]>e}}),u=e.exports={checks:new a,limited:new l},c=Backbone.Model.extend({defaults:r,initialize:function(t,e){u.checks.on("change",this.onChecks,this),u.limited.on("change",this.onLimited,this),this.on("change",function(t){o.channel("layers").trigger("active",t.changed)})},onChecks:function(t){for(var e in t.changed)u.limited.get(e)&&this.set(e,t.get(e))},onLimited:function(t){for(var e in t.changed)this.set(e,t.get(e)&&u.checks.get(e))}});new c},{}],68:[function(t,e,n){var i=t("moment"),o=app.events,s=app.options.meteo,r=Backbone.View.extend({template:_.template($("#temp-menu-meteo").html()),model:t("./models").checks,limited:t("./models").limited,bindings:_.object(_.keys(s).map(function(t){return["#"+t,t]})),meteoStep:[5,7,9,11,15,19,23,27],events:{"change #meteo-time":"onTime","click #meteo-animation":"onAnimation"},initialize:function(t,e){this.render(),this.$elListTime=this.$("#meteo-time"),this.$elProgressTime=this.$("#meteo-progress-time"),this._createListTime().forEach(function(t){this.$elListTime.append('<option value ="{0}">{1}</option>'.replace("{0}",t.value).replace("{1}",t.title))},this),this.stickit(),this.limited.on("change",this.onLimited,this)},render:function(){this.$el.append(this.template(s));for(var t in this.limited.toJSON())this._setLimited(t,this.limited.get(t))},onTime:function(t){o.channel("layers").trigger("meteotime",t.target.value)},onAnimation:function(t){clearInterval(this._key);var e=this.$elProgressTime.removeClass("hide").find(".progress-bar"),n=this.$elListTime.val(),i=(this._createListTime(),100/(this.meteoStep.length-1));this.$elListTime.focus(),this._index=0,this._setMeteoTime(this.meteoStep[this._index]),e.width(this._index*i+"%"),this._index++,this._key=setInterval(function(){this.meteoStep[this._index]?(this._setMeteoTime(this.meteoStep[this._index]),e.width(this._index*i+"%"),this._index++):(clearInterval(this._key),this._setMeteoTime(n),this.$elProgressTime.addClass("hide"),e.width("0%"))}.bind(this),2e3)},onLimited:function(t){for(var e in t.changed)this._setLimited(e,t.get(e))},_setProgress:function(t,e,n){},_setMeteoTime:function(t){this.$elListTime.val(t).trigger("change")},_setLimited:function(t,e){this.$("#"+t).prop("disabled",!e).parent().toggleClass("map-air-space-limited",!e).attr("title",e?s[t].title:"ограничение zoom...")},_createListTime:function(){var t=i.utc(i().format("YYYYMMDD000000"),"YYYYMMDDHHmmss");(new Date).getUTCHours();return this.meteoStep.map(function(e,n){return t.add(4>n?6:12,"hours"),{value:e,title:t.utc().format("DD-MMM HH:00 UTC")}})}});e.exports=r},{"./models":67,moment:83}],69:[function(t,e,n){var i=L.Control.extend({options:{hide:!1,position:"bottomright",className:"icon-wind-scale map-wind-scale"},includes:L.Mixin.Events,initialize:function(t){i.__super__.initialize.apply(this,arguments),this._create(this.options)},onAdd:function(t){return this.el},_create:function(t){var e=this.el=L.DomUtil.create("div",t.className),n=L.DomEvent.stopPropagation;return L.DomEvent.on(e,"contextmenu",n).on(e,"contextmenu",L.DomEvent.preventDefault).on(e,"click",n).on(e,"mousedown",n).on(e,"dblclick",n).on(e,"click",L.DomEvent.preventDefault).on(e,"click",this._refocusOnMap,this),this.$el=$(e).attr({id:t.id,title:t.title}),t.icon&&this.$el.append(t.icon),e}}),o=new i;app.events.channel("layers").on("active",function(t){"WIND"in t&&(t.WIND?app.map.addControl(o):app.map.removeControl(o))})},{}],70:[function(t,e,n){var i=t("../../../libs/views/tabs"),o=t("./model"),s=t("./private"),r=t("./social-networks"),a=app.events.channel("auth"),l=i.extend({initialize:function(t){l.__super__.initialize.apply(this,arguments),this.views={},this.setTabs(t.tabs)},setTabs:function(t){for(var e in t){var n=t[e];this.views[e]=new n({el:this.$(e),model:this.model})}},cmdLogout:function(t){return $.get("/api/auth/logout").fail(function(){window.location="/"}).done(function(t){a.trigger("logout")}),!1}});e.exports={position:"topright",id:"profile",title:"Профиль пользователя",icon:"<div></dic>",hide:!0,popover:{view:new l({el:$("#temp-profile").html(),tabs:{".tab1":s,".tab2":r},model:new o}),title:"Профиль пользователя"}}},{"../../../libs/views/tabs":34,"./model":71,"./private":72,"./social-networks":73}],71:[function(t,e,n){var i=t("../../../libs/views/remote-mix"),o=app.events.channel("auth"),s=Backbone.Model.extend({idAttribute:"_id",defaults:{}}),r=Backbone.Collection.extend({url:"/api/auth/networks",model:s,initialize:function(){o.on("login",this.onLogin,this)},onLogin:function(t){this.fetch({reset:!0})}}),a=Backbone.Model.extend(i.Model),l=a.extend({networks:new r,urlRoot:"/api/auth/login",defaults:{username:"",name:"",phone:""},validation:{username:{required:!0,pattern:"email"},name:{minLength:5,remoteErr400:{}},phone:{minLength:10,remoteErr400:{}},remoteErr:{remote:{fn:function(t,e){return 400===t.status?null:e.messageError(t)}}}},initialize:function(){l.__super__.initialize.apply(this,arguments),o.on("login",this.onLogin,this)},onLogin:function(t){this.set(t)}});e.exports=l},{"../../../libs/views/remote-mix":33}],72:[function(t,e,n){var i=t("../../../libs/views/remote-mix"),o=app.events.channel("auth"),s=Backbone.View.extend(i.View),r=s.extend({events:{submit:"onSubmit"},bindings:{"[name=username]":"username","[name=name]":"name","[name=phone]":"phone"},initialize:function(t,e){Backbone.Validation.bind(this),this.stickit(),this._setRemoteEvents(),o.on("login",this.onLogin,this)},onSync:function(){this._mask().end()},onError:function(t,e,n){this._mask().end(300,function(){this.model.remoteValidate(e)},this)},onSubmit:function(t){t.preventDefault(),this.model.save()},onLogin:function(t){this.model.set(t)},_maskSelector:function(){return this.$el.parents(".popover-content")}});e.exports=r},{"../../../libs/views/remote-mix":33}],73:[function(t,e,n){var i=(app.events.channel("auth"),t("../../../libs/views/command")),o=i.extend({itemTemplate:$("#temp-profile-item-nets").html(),initialize:function(t){o.__super__.initialize.apply(this,arguments),this.$table=this.$("#nets"),this.collection=this.model.networks,this.collection.on("reset add remove",this.render,this),window.preBinding=this._token.bind(this)},addNetwork:function(t){t=$.parseJSON(t.toString()),t.error||this.collection.create(t,{wait:!0})},render:function(){this.$table.empty(),this.collection.each(this.renderItem,this)},renderItem:function(t){var e=L.Util.template(this.itemTemplate,t.toJSON());this.$("#nets").append(e)},cmdRemove:function(t){t.preventDefault();var e=$(t.currentTarget).data("index");return this.collection.get(e).destroy({wait:!0}),!1},_token:function(t){var e=this.addNetwork.bind(this);$.getJSON("//ulogin.ru/token.php?host="+encodeURIComponent(location.toString())+"&token="+t+"&callback=?",e)}});e.exports=o},{"../../../libs/views/command":31}],74:[function(t,e,n){var i=function(t){this.initialize(t)};i.prototype={events:app.events.channel("route"),initialize:function(t){this.route=t,this.events.on("add",this.onAdd,this).on("remove",this.onRemove,this).on("change",this.onChange,this).on("reset",this.onReset,this).on("reverse",this.onReverse,this)},onAdd:function(t,e){this.route.add(t,e)},onRemove:function(t,e){t=this._getModel(t),this.route.remove(t,e)},onChange:function(t,e,n){t=this._getModel(t),t.set(e,n)},onReset:function(t,e){this.route.reset(t,e)},onReverse:function(){this.route.reverse()},_getModel:function(t){return _.isString(t)?this.route.get(t):t}},e.exports=i},{}],75:[function(t,e,n){"use strict";var i=t("./model"),o=t("./controller"),s=t("./views/map/route"),r=new i([],{parse:!0});new o(r);var a=new s(r);a.addTo(app.map)},{"./controller":74,"./model":76,"./views/map/route":81}],76:[function(t,e,n){"use strict";var i=Backbone.Model.extend({defaults:{id:null,type:"wp",name:"Way Point",latlng:null,icon:null},isDefaultType:function(){return this.get("type")===this.defaults.type},getIcon:function(){return this.get("icon")||this.get("type")},parse:function(t){return t.latlng&&_.isArray(t.latlng)&&(t.latlng=L.latLng(t.latlng)),t},next:function(){var t=this.collection.indexOf(this);return this.collection.models[t+1]},prev:function(){var t=this.collection.indexOf(this);return this.collection.models[t-1]},isChangeRouteMap:function(){return!!(this.changed.latlng||this.changed.type||this.changed.icon)}}),o=Backbone.Collection.extend({model:i,getPath:function(){return this.pluck("latlng")},reverse:function(){var t=this.models.reverse();this.reset(t)}});e.exports=o},{}],77:[function(t,e,n){"use strict";var i=t("./drag-marker"),o=app.events,s=i.extend({options:{draggable:!0,zIndexOffset:1e3,icon:L.divIcon({className:"icon-airplane",iconSize:L.point(16,16)})},initialize:function(t,e){s.__super__.initialize.apply(this,arguments),this.angle=0},refresh:function(t){var e=this.model.next();t._map&&e?(this.angle=this._calcAngle(e,t._map),this.setLatLng(this._calcLatlng(e,t._map,!0)),this.visible(!0)):this.visible(!1)},onClick:function(t){t.model=this.model,o.channel("info").trigger("direction",t)},onDrag:function(){var t=_.compact([this.model.get("latlng"),this.getLatLng(),this.model.next()&&this.model.next().get("latlng")]);this.dragLine.setLatLngs([t])},_setPos:function(t){if(s.__super__._setPos.apply(this,arguments),L.DomUtil.TRANSFORM)this._icon.style[L.DomUtil.TRANSFORM]+=" rotate("+this.angle+"deg)";else if(L.Browser.ie){var e=this.angle*L.LatLng.DEG_TO_RAD,n=Math.cos(e),i=Math.sin(e);this._icon.style.filter+=" progid:DXImageTransform.Microsoft.Matrix(sizingMethod='auto expand', M11="+n+", M12="+-i+", M21="+i+", M22="+n+")"}},_calcLatlng:function(t,e,n){var i=this.model.get("latlng"),o=t.get("latlng");if(n){var s=this.dragLine._vincenty_inverse(i,o),r=this.dragLine._vincenty_direct(i,s.initialBearing,s.distance/2);return r}return this.model.get("latlng").middle(t.get("latlng"),e)},_calcAngle:function(t,e,n){var i=this.model.get("latlng"),o=t.get("latlng");if(n){var s=this.dragLine._vincenty_inverse(i,o);return(s.initialBearing+360)%360}return i.angle(o,e)}});e.exports=s},{"./drag-marker":78}],78:[function(t,e,n){"use strict";var i=L.MarkerModel.extend({options:{draggable:!0},dragLine:L.geodesic([],{steps:50,className:"map-route-line-drag"}),initialize:function(t,e){i.__super__.initialize.apply(this,arguments)},refresh:function(){},toggle:function(t,e){t&&(e?!t.hasLayer(this)&&t.addLayer(this):t.hasLayer(this)&&t.removeLayer(this))},onAdd:function(t){i.__super__.onAdd.apply(this,arguments),this.onClick&&this.on("click",this.onClick,this),this._setup(t)},onRemove:function(){this._clear(),i.__super__.onRemove.apply(this,arguments)},onDragstart:function(){this._startLatlng=this.getLatLng(),this.dragLine.addTo(this._map)},onDrag:function(t){},onDragend:function(t){t.endLatlng=this.getLatLng(),this.setLatLng(this._startLatlng),this.dragLine.setLatLngs([]),this._map.removeLayer(this.dragLine)},_setEvents:function(){this.on("dragstart",this.onDragstart,this).on("drag",this.onDrag,this).on("dragend",this.onDragend,this)},_setup:function(){this.options.draggable&&this._setEvents()},_clear:function(){this.off(null,null,this),this.model.off(null,null,this),this.model=null}});e.exports=i},{}],79:[function(t,e,n){"use strict";var i=t("./direction"),o=i.extend({template:'<div class="{c}" title="{a}&deg; {d} км">{a}&deg; {d} км</div>',options:{zIndexOffset:1e3,draggable:!1,clickable:!1,icon:L.divIcon({iconSize:new L.Point(80,12),iconAnchor:new L.Point(0,6),className:"map-direct-icon"})},refresh:function(t){var e=this.model.next();if(t._map&&e){var n=(this._calcLatlng(e,t._map,!0),this._calcAngle(e,t._map,!0));this.angle=n-90,this.setLatLng(this.model.get("latlng")),this.visible(!0),this.setHtml(n,this.model.get("latlng").distanceTo(e.get("latlng")),this._pixelsToNext(t._map)/2)}else this.visible(!1)},setHtml:function(t,e,n){var i=$(this._icon);n<this.options.icon.options.iconSize.x+10?i.hide():i.html(L.Util.template(this.template,{c:t>180?"map-direct-icon-180":"",a:0|t,d:e/1e3|0})).show()},_pixelsToNext:function(t){var e=this.model.next();return e?this.model.get("latlng").toPoint(t).distanceTo(e.get("latlng").toPoint(t)):0},_angleDiv:function(t){this._calcLatlng(t,null,!0),this._calcAngle(t,layer._map,!0)}});e.exports=o},{"./direction":77}],80:[function(t,e,n){"use strict";var i=t("./vertex"),o=t("./direction"),s=t("./informer"),r=L.LayerModel.extend({options:{},_evRoute:app.events.channel("route"),initialize:function(t,e){r.__super__.initialize.apply(this,arguments),this.direction=new o(this.model,this.options.direction).on("dragend",this.onDragendDirection,this).on("click",this.onClick,this),this.addLayer(this.direction),this.vertex=new i(this.model,this.options.vertex).on("contextmenu",this.onContextmenuVertex,this).on("dragend",this.onDragendVertex,this),this.addLayer(this.vertex),this.informer=new s(this.model),this.addLayer(this.informer)},onAdd:function(t){r.__super__.onAdd.apply(this,arguments),this.update(t),t.on("zoomend",this.onZoom,this)},onRemove:function(){this._map.off("zoomend",this.onZoom,this),this.eachLayer(function(t){t.off&&t.off(null,null,this)},this),this.vertex=this.informer=this.direction=this.model=null,r.__super__.onRemove.apply(this,arguments)},onZoom:function(){this.informer.refresh(this)},onClick:function(t){},update:function(){return this.direction.refresh(this),this.informer.refresh(this),this},indexOf:function(){return this.model.collection.indexOf(this.model)},onDragendVertex:function(t){this._evRoute.trigger("change",this.model.cid,{latlng:t.endLatlng})},onContextmenuVertex:function(){setTimeout(function(){this._evRoute.trigger("remove",this.model)}.bind(this))},onDragendDirection:function(t){this._evRoute.trigger("add",{latlng:t.endLatlng},{at:this.indexOf()+1})}});e.exports=r},{"./direction":77,"./informer":79,"./vertex":82}],81:[function(t,e,n){"use strict";var i=t("./marker"),o=L.LayerCollection.extend({options:{vertex:{draggable:!0},line:{steps:50,className:"map-route-line",clickable:!1}},datum:{ellipsoid:{a:6378137,b:6356752.3142,f:1/298.257223563}},initialize:function(t){o.__super__.initialize.apply(this,arguments);var e=this.collection.getPath();this.line=L.geodesic([e],this.options.line),this.createMarkers(),this.collection.on("change:latlng",this.onModelLatlng,this).on("remove",this.onModelRemove,this).on("add",this.onModelAdd,this).on("reset",this.onModelReset,this)},onAdd:function(t){o.__super__.onAdd.apply(this,arguments),this.addLayer(this.line)},onRemove:function(){this.collection.off(null,null,this),o.__super__.onRemove.apply(this,arguments)},capture:function(t,e,n){var o=n||this._map;return o?this.getLayers().filter(function(n){return n instanceof i&&n.vertex.getLatLng().toPoint(o).distanceTo(t.toPoint(o))<=e},this).map(function(e){return{layer:e,distance:e.vertex.getLatLng().distanceTo(t)}}):[]},update:function(){this.line.setLatLngs([this.collection.getPath()]),this.eachLayer(function(t){t instanceof i&&t.update()})},createMarkers:function(){this.collection.each(function(t){this.addLayer(new i(t))},this)},onModelLatlng:function(){this.update()},onModelAdd:function(t){this.addLayer(new i(t,this.options.vertex)),this.update()},onModelRemove:function(t){var e=_.findWhere(this.getLayers(),{model:t});this.removeLayer(e),this.update()},onModelReset:function(){this.eachLayer(function(t){t instanceof i&&this.removeLayer(t)},this),this.createMarkers(),this.update()},_vincenty_inverse:function(t,e){var n,i=t.lat.toRadians(),o=t.lng.toRadians(),s=e.lat.toRadians(),r=e.lng.toRadians(),a=this.datum.ellipsoid.a,l=this.datum.ellipsoid.b,u=this.datum.ellipsoid.f,c=r-o,h=(1-u)*Math.tan(i),d=1/Math.sqrt(1+h*h),p=h*d,f=(1-u)*Math.tan(s),m=1/Math.sqrt(1+f*f),g=f*m,v=c,_=0;do{var y=Math.sin(v),b=Math.cos(v),w=m*y*(m*y)+(d*g-p*m*b)*(d*g-p*m*b),M=Math.sqrt(w);if(0==M)return 0;var L=p*g+d*m*b,k=Math.atan2(M,L),x=d*m*y/M,D=1-x*x,S=L-2*p*g/D;isNaN(S)&&(S=0);var T=u/16*D*(4+u*(4-3*D));n=v,v=c+(1-T)*u*x*(k+T*M*(S+T*L*(-1+2*S*S)))}while(Math.abs(v-n)>1e-12&&++_<100);if(_>=100)return console.log("Formula failed to converge. Altering target position."),this._vincenty_inverse(t,{lat:e.lat,lng:e.lng-.01});var C=D*(a*a-l*l)/(l*l),P=1+C/16384*(4096+C*(-768+C*(320-175*C))),O=C/1024*(256+C*(-128+C*(74-47*C))),A=O*M*(S+O/4*(L*(-1+2*S*S)-O/6*S*(-3+4*M*M)*(-3+4*S*S))),E=l*P*(k-A),z=Math.atan2(m*y,d*g-p*m*b),Y=Math.atan2(d*y,-p*m+d*g*b);return E=Number(E.toFixed(3)),{distance:E,initialBearing:z.toDegrees(),finalBearing:Y.toDegrees()}},_intersection:function(t,e,n,i){var o=t.lat.toRadians(),s=t.lng.toRadians(),r=n.lat.toRadians(),a=n.lng.toRadians(),l=Number(e).toRadians(),u=Number(i).toRadians(),c=r-o,h=a-s,d=2*Math.asin(Math.sqrt(Math.sin(c/2)*Math.sin(c/2)+Math.cos(o)*Math.cos(r)*Math.sin(h/2)*Math.sin(h/2)));if(0==d)return null;var p=Math.acos((Math.sin(r)-Math.sin(o)*Math.cos(d))/(Math.sin(d)*Math.cos(o)));isNaN(p)&&(p=0);var f=Math.acos((Math.sin(o)-Math.sin(r)*Math.cos(d))/(Math.sin(d)*Math.cos(r)));if(Math.sin(a-s)>0)var m=p,g=2*Math.PI-f;else var m=2*Math.PI-p,g=f;var v=(l-m+Math.PI)%(2*Math.PI)-Math.PI,_=(g-u+Math.PI)%(2*Math.PI)-Math.PI;if(0==Math.sin(v)&&0==Math.sin(_))return null;if(Math.sin(v)*Math.sin(_)<0)return null;var y=Math.acos(-Math.cos(v)*Math.cos(_)+Math.sin(v)*Math.sin(_)*Math.cos(d)),b=Math.atan2(Math.sin(d)*Math.sin(v)*Math.sin(_),Math.cos(_)+Math.cos(v)*Math.cos(y)),w=Math.asin(Math.sin(o)*Math.cos(b)+Math.cos(o)*Math.sin(b)*Math.cos(l)),M=Math.atan2(Math.sin(l)*Math.sin(b)*Math.cos(o),Math.cos(b)-Math.sin(o)*Math.sin(w)),k=s+M;return k=(k+3*Math.PI)%(2*Math.PI)-Math.PI,L.latLng(w.toDegrees(),k.toDegrees())},_intersectionSeg:function(t,e){var n=this._vincenty_inverse.apply(this,t),i=this._vincenty_inverse.apply(this,e),o=this._intersection(t[0],n.initialBearing,e[0],i.initialBearing);return o&&Math.abs(t[0].distanceTo(t[1])-o.distanceTo(t[0])-o.distanceTo(t[1]))<LIMIT&&Math.abs(e[0].distanceTo(e[1])-o.distanceTo(e[0])-o.distanceTo(e[1]))<LIMIT?o:null},intersectionTo:function(t){for(var e=this.getLatLngs(),n=t.getLatLngs(),i=[],o=0,s=e.length-1;s>o;o++)for(var r=0,a=e.length-1;a>r;o++){var l=this._intersectionSeg([e[o],e[o+1]],[n[r],n[r+1]]);l&&i.push(l)}return i.length?i:null}});e.exports=o},{"./marker":80}],82:[function(t,e,n){"use strict";var i=t("./drag-marker"),o=app.events,s=t("../../../../core/options").icons,r=i.extend({options:{zIndexOffset:1010},initialize:function(t,e){var n=_.extend(this._getOptions(t),e);r.__super__.initialize.call(this,t,n),this.model.on("change",this.onChange,this)},setDragging:function(t){t=t||this.options.draggable,this.dragging[t?"enable":"disable"]()},refresh:function(){},onClick:function(t){t.model=this.model,o.channel("info").trigger("route:vertex",t)},onDrag:function(){var t=_.compact([this.model.prev()&&this.model.prev().get("latlng"),this.getLatLng(),this.model.next()&&this.model.next().get("latlng")]);this.dragLine.setLatLngs([t])},onChange:function(t){t.isChangeRouteMap()&&(L.Util.setOptions(this,this._getOptions(t)),(t.changed.type||t.changed.icon)&&(this.setIcon(this.options.icon),this.setDragging()),t.changed.latlng&&this.setLatLng(this.model.get("latlng")))},_getOptions:function(t){return{draggable:t.isDefaultType(),title:t.get("name"),icon:this._getIcon(t)}},_getIcon:function(t){return t=t||this.model,s[t.getIcon()]}});e.exports=r},{"../../../../core/options":5,"./drag-marker":78}],83:[function(t,e,n){!function(t,i){"object"==typeof n&&"undefined"!=typeof e?e.exports=i():"function"==typeof define&&define.amd?define(i):t.moment=i()}(this,function(){"use strict";function n(){return Nn.apply(null,arguments)}function i(t){Nn=t}function o(t){return"[object Array]"===Object.prototype.toString.call(t)}function s(t){return t instanceof Date||"[object Date]"===Object.prototype.toString.call(t)}function r(t,e){var n,i=[];for(n=0;n<t.length;++n)i.push(e(t[n],n));return i}function a(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function l(t,e){for(var n in e)a(e,n)&&(t[n]=e[n]);return a(e,"toString")&&(t.toString=e.toString),a(e,"valueOf")&&(t.valueOf=e.valueOf),t}function u(t,e,n,i){return Pt(t,e,n,i,!0).utc()}function c(){return{empty:!1,unusedTokens:[],unusedInput:[],overflow:-2,charsLeftOver:0,nullInput:!1,invalidMonth:null,invalidFormat:!1,userInvalidated:!1,iso:!1}}function h(t){return null==t._pf&&(t._pf=c()),t._pf}function d(t){if(null==t._isValid){var e=h(t);t._isValid=!(isNaN(t._d.getTime())||!(e.overflow<0)||e.empty||e.invalidMonth||e.invalidWeekday||e.nullInput||e.invalidFormat||e.userInvalidated),t._strict&&(t._isValid=t._isValid&&0===e.charsLeftOver&&0===e.unusedTokens.length&&void 0===e.bigHour)}return t._isValid}function p(t){var e=u(NaN);return null!=t?l(h(e),t):h(e).userInvalidated=!0,e}function f(t,e){var n,i,o;if("undefined"!=typeof e._isAMomentObject&&(t._isAMomentObject=e._isAMomentObject),"undefined"!=typeof e._i&&(t._i=e._i),"undefined"!=typeof e._f&&(t._f=e._f),"undefined"!=typeof e._l&&(t._l=e._l),"undefined"!=typeof e._strict&&(t._strict=e._strict),"undefined"!=typeof e._tzm&&(t._tzm=e._tzm),"undefined"!=typeof e._isUTC&&(t._isUTC=e._isUTC),"undefined"!=typeof e._offset&&(t._offset=e._offset),"undefined"!=typeof e._pf&&(t._pf=h(e)),"undefined"!=typeof e._locale&&(t._locale=e._locale),In.length>0)for(n in In)i=In[n],o=e[i],"undefined"!=typeof o&&(t[i]=o);return t}function m(t){f(this,t),this._d=new Date(null!=t._d?t._d.getTime():NaN),Rn===!1&&(Rn=!0,n.updateOffset(this),Rn=!1)}function g(t){return t instanceof m||null!=t&&null!=t._isAMomentObject}function v(t){return 0>t?Math.ceil(t):Math.floor(t)}function _(t){var e=+t,n=0;return 0!==e&&isFinite(e)&&(n=v(e)),n}function y(t,e,n){var i,o=Math.min(t.length,e.length),s=Math.abs(t.length-e.length),r=0;for(i=0;o>i;i++)(n&&t[i]!==e[i]||!n&&_(t[i])!==_(e[i]))&&r++;return r+s}function b(){}function w(t){return t?t.toLowerCase().replace("_","-"):t}function M(t){for(var e,n,i,o,s=0;s<t.length;){for(o=w(t[s]).split("-"),e=o.length,n=w(t[s+1]),n=n?n.split("-"):null;e>0;){if(i=L(o.slice(0,e).join("-")))return i;if(n&&n.length>=e&&y(o,n,!0)>=e-1)break;e--}s++}return null}function L(n){var i=null;if(!Fn[n]&&"undefined"!=typeof e&&e&&e.exports)try{i=$n._abbr,t("./locale/"+n),k(i)}catch(o){}return Fn[n]}function k(t,e){var n;return t&&(n="undefined"==typeof e?D(t):x(t,e),n&&($n=n)),$n._abbr}function x(t,e){return null!==e?(e.abbr=t,Fn[t]=Fn[t]||new b,Fn[t].set(e),k(t),Fn[t]):(delete Fn[t],null)}function D(t){var e;if(t&&t._locale&&t._locale._abbr&&(t=t._locale._abbr),!t)return $n;if(!o(t)){if(e=L(t))return e;t=[t]}return M(t)}function S(t,e){var n=t.toLowerCase();jn[n]=jn[n+"s"]=jn[e]=t}function T(t){return"string"==typeof t?jn[t]||jn[t.toLowerCase()]:void 0}function C(t){var e,n,i={};for(n in t)a(t,n)&&(e=T(n),e&&(i[e]=t[n]));return i}function P(t,e){return function(i){return null!=i?(A(this,t,i),n.updateOffset(this,e),this):O(this,t)}}function O(t,e){return t._d["get"+(t._isUTC?"UTC":"")+e]()}function A(t,e,n){return t._d["set"+(t._isUTC?"UTC":"")+e](n)}function E(t,e){var n;if("object"==typeof t)for(n in t)this.set(n,t[n]);else if(t=T(t),"function"==typeof this[t])return this[t](e);return this}function z(t,e,n){var i=""+Math.abs(t),o=e-i.length,s=t>=0;return(s?n?"+":"":"-")+Math.pow(10,Math.max(0,o)).toString().substr(1)+i}function Y(t,e,n,i){var o=i;"string"==typeof i&&(o=function(){return this[i]()}),t&&(Hn[t]=o),e&&(Hn[e[0]]=function(){return z(o.apply(this,arguments),e[1],e[2])}),n&&(Hn[n]=function(){return this.localeData().ordinal(o.apply(this,arguments),t)})}function N(t){return t.match(/\[[\s\S]/)?t.replace(/^\[|\]$/g,""):t.replace(/\\/g,"")}function $(t){var e,n,i=t.match(Bn);for(e=0,n=i.length;n>e;e++)Hn[i[e]]?i[e]=Hn[i[e]]:i[e]=N(i[e]);return function(o){var s="";for(e=0;n>e;e++)s+=i[e]instanceof Function?i[e].call(o,t):i[e];return s}}function I(t,e){return t.isValid()?(e=R(e,t.localeData()),Wn[e]=Wn[e]||$(e),Wn[e](t)):t.localeData().invalidDate()}function R(t,e){function n(t){return e.longDateFormat(t)||t}var i=5;for(Un.lastIndex=0;i>=0&&Un.test(t);)t=t.replace(Un,n),Un.lastIndex=0,i-=1;return t}function F(t){return"function"==typeof t&&"[object Function]"===Object.prototype.toString.call(t)}function j(t,e,n){ri[t]=F(e)?e:function(t){return t&&n?n:e}}function B(t,e){return a(ri,t)?ri[t](e._strict,e._locale):new RegExp(U(t))}function U(t){return t.replace("\\","").replace(/\\(\[)|\\(\])|\[([^\]\[]*)\]|\\(.)/g,function(t,e,n,i,o){return e||n||i||o}).replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}function W(t,e){var n,i=e;for("string"==typeof t&&(t=[t]),"number"==typeof e&&(i=function(t,n){n[e]=_(t)}),n=0;n<t.length;n++)ai[t[n]]=i}function H(t,e){W(t,function(t,n,i,o){i._w=i._w||{},e(t,i._w,i,o)})}function V(t,e,n){null!=e&&a(ai,t)&&ai[t](e,n._a,n,t)}function G(t,e){return new Date(Date.UTC(t,e+1,0)).getUTCDate()}function Z(t){return this._months[t.month()]}function q(t){return this._monthsShort[t.month()]}function J(t,e,n){var i,o,s;for(this._monthsParse||(this._monthsParse=[],this._longMonthsParse=[],this._shortMonthsParse=[]),i=0;12>i;i++){if(o=u([2e3,i]),n&&!this._longMonthsParse[i]&&(this._longMonthsParse[i]=new RegExp("^"+this.months(o,"").replace(".","")+"$","i"),this._shortMonthsParse[i]=new RegExp("^"+this.monthsShort(o,"").replace(".","")+"$","i")),n||this._monthsParse[i]||(s="^"+this.months(o,"")+"|^"+this.monthsShort(o,""),this._monthsParse[i]=new RegExp(s.replace(".",""),"i")),n&&"MMMM"===e&&this._longMonthsParse[i].test(t))return i;if(n&&"MMM"===e&&this._shortMonthsParse[i].test(t))return i;if(!n&&this._monthsParse[i].test(t))return i}}function X(t,e){var n;return"string"==typeof e&&(e=t.localeData().monthsParse(e),"number"!=typeof e)?t:(n=Math.min(t.date(),G(t.year(),e)),t._d["set"+(t._isUTC?"UTC":"")+"Month"](e,n),t)}function K(t){return null!=t?(X(this,t),n.updateOffset(this,!0),this):O(this,"Month")}function Q(){return G(this.year(),this.month())}function tt(t){var e,n=t._a;return n&&-2===h(t).overflow&&(e=n[ui]<0||n[ui]>11?ui:n[ci]<1||n[ci]>G(n[li],n[ui])?ci:n[hi]<0||n[hi]>24||24===n[hi]&&(0!==n[di]||0!==n[pi]||0!==n[fi])?hi:n[di]<0||n[di]>59?di:n[pi]<0||n[pi]>59?pi:n[fi]<0||n[fi]>999?fi:-1,h(t)._overflowDayOfYear&&(li>e||e>ci)&&(e=ci),h(t).overflow=e),t}function et(t){n.suppressDeprecationWarnings===!1&&"undefined"!=typeof console&&console.warn&&console.warn("Deprecation warning: "+t)}function nt(t,e){var n=!0;return l(function(){return n&&(et(t+"\n"+(new Error).stack),n=!1),e.apply(this,arguments)},e)}function it(t,e){vi[t]||(et(e),vi[t]=!0)}function ot(t){var e,n,i=t._i,o=_i.exec(i);if(o){for(h(t).iso=!0,e=0,n=yi.length;n>e;e++)if(yi[e][1].exec(i)){t._f=yi[e][0];break}for(e=0,n=bi.length;n>e;e++)if(bi[e][1].exec(i)){t._f+=(o[6]||" ")+bi[e][0];break}i.match(ii)&&(t._f+="Z"),Lt(t)}else t._isValid=!1}function st(t){var e=wi.exec(t._i);return null!==e?void(t._d=new Date(+e[1])):(ot(t),void(t._isValid===!1&&(delete t._isValid,n.createFromInputFallback(t))))}function rt(t,e,n,i,o,s,r){var a=new Date(t,e,n,i,o,s,r);return 1970>t&&a.setFullYear(t),a}function at(t){var e=new Date(Date.UTC.apply(null,arguments));return 1970>t&&e.setUTCFullYear(t),e}function lt(t){return ut(t)?366:365}function ut(t){return t%4===0&&t%100!==0||t%400===0}function ct(){return ut(this.year())}function ht(t,e,n){var i,o=n-e,s=n-t.day();return s>o&&(s-=7),o-7>s&&(s+=7),i=Ot(t).add(s,"d"),{week:Math.ceil(i.dayOfYear()/7),year:i.year()}}function dt(t){return ht(t,this._week.dow,this._week.doy).week}function pt(){return this._week.dow}function ft(){return this._week.doy}function mt(t){var e=this.localeData().week(this);return null==t?e:this.add(7*(t-e),"d")}function gt(t){var e=ht(this,1,4).week;return null==t?e:this.add(7*(t-e),"d")}function vt(t,e,n,i,o){var s,r=6+o-i,a=at(t,0,1+r),l=a.getUTCDay();return o>l&&(l+=7),n=null!=n?1*n:o,s=1+r+7*(e-1)-l+n,{year:s>0?t:t-1,dayOfYear:s>0?s:lt(t-1)+s}}function _t(t){var e=Math.round((this.clone().startOf("day")-this.clone().startOf("year"))/864e5)+1;return null==t?e:this.add(t-e,"d")}function yt(t,e,n){return null!=t?t:null!=e?e:n}function bt(t){var e=new Date;return t._useUTC?[e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate()]:[e.getFullYear(),e.getMonth(),e.getDate()]}function wt(t){var e,n,i,o,s=[];if(!t._d){for(i=bt(t),t._w&&null==t._a[ci]&&null==t._a[ui]&&Mt(t),t._dayOfYear&&(o=yt(t._a[li],i[li]),t._dayOfYear>lt(o)&&(h(t)._overflowDayOfYear=!0),n=at(o,0,t._dayOfYear),t._a[ui]=n.getUTCMonth(),t._a[ci]=n.getUTCDate()),e=0;3>e&&null==t._a[e];++e)t._a[e]=s[e]=i[e];for(;7>e;e++)t._a[e]=s[e]=null==t._a[e]?2===e?1:0:t._a[e];24===t._a[hi]&&0===t._a[di]&&0===t._a[pi]&&0===t._a[fi]&&(t._nextDay=!0,t._a[hi]=0),t._d=(t._useUTC?at:rt).apply(null,s),null!=t._tzm&&t._d.setUTCMinutes(t._d.getUTCMinutes()-t._tzm),t._nextDay&&(t._a[hi]=24)}}function Mt(t){var e,n,i,o,s,r,a;e=t._w,null!=e.GG||null!=e.W||null!=e.E?(s=1,r=4,n=yt(e.GG,t._a[li],ht(Ot(),1,4).year),i=yt(e.W,1),o=yt(e.E,1)):(s=t._locale._week.dow,r=t._locale._week.doy,n=yt(e.gg,t._a[li],ht(Ot(),s,r).year),i=yt(e.w,1),null!=e.d?(o=e.d,s>o&&++i):o=null!=e.e?e.e+s:s),a=vt(n,i,o,r,s),t._a[li]=a.year,t._dayOfYear=a.dayOfYear}function Lt(t){if(t._f===n.ISO_8601)return void ot(t);t._a=[],h(t).empty=!0;var e,i,o,s,r,a=""+t._i,l=a.length,u=0;for(o=R(t._f,t._locale).match(Bn)||[],e=0;e<o.length;e++)s=o[e],i=(a.match(B(s,t))||[])[0],i&&(r=a.substr(0,a.indexOf(i)),r.length>0&&h(t).unusedInput.push(r),a=a.slice(a.indexOf(i)+i.length),u+=i.length),Hn[s]?(i?h(t).empty=!1:h(t).unusedTokens.push(s),V(s,i,t)):t._strict&&!i&&h(t).unusedTokens.push(s);h(t).charsLeftOver=l-u,a.length>0&&h(t).unusedInput.push(a),h(t).bigHour===!0&&t._a[hi]<=12&&t._a[hi]>0&&(h(t).bigHour=void 0),t._a[hi]=kt(t._locale,t._a[hi],t._meridiem),wt(t),tt(t)}function kt(t,e,n){var i;return null==n?e:null!=t.meridiemHour?t.meridiemHour(e,n):null!=t.isPM?(i=t.isPM(n),i&&12>e&&(e+=12),i||12!==e||(e=0),e):e}function xt(t){var e,n,i,o,s;if(0===t._f.length)return h(t).invalidFormat=!0,void(t._d=new Date(NaN));for(o=0;o<t._f.length;o++)s=0,e=f({},t),null!=t._useUTC&&(e._useUTC=t._useUTC),e._f=t._f[o],Lt(e),d(e)&&(s+=h(e).charsLeftOver,s+=10*h(e).unusedTokens.length,h(e).score=s,(null==i||i>s)&&(i=s,n=e));l(t,n||e)}function Dt(t){if(!t._d){var e=C(t._i);t._a=[e.year,e.month,e.day||e.date,e.hour,e.minute,e.second,e.millisecond],wt(t)}}function St(t){var e=new m(tt(Tt(t)));return e._nextDay&&(e.add(1,"d"),e._nextDay=void 0),e}function Tt(t){var e=t._i,n=t._f;return t._locale=t._locale||D(t._l),null===e||void 0===n&&""===e?p({nullInput:!0}):("string"==typeof e&&(t._i=e=t._locale.preparse(e)),g(e)?new m(tt(e)):(o(n)?xt(t):n?Lt(t):s(e)?t._d=e:Ct(t),t))}function Ct(t){var e=t._i;void 0===e?t._d=new Date:s(e)?t._d=new Date(+e):"string"==typeof e?st(t):o(e)?(t._a=r(e.slice(0),function(t){return parseInt(t,10)}),wt(t)):"object"==typeof e?Dt(t):"number"==typeof e?t._d=new Date(e):n.createFromInputFallback(t)}function Pt(t,e,n,i,o){var s={};return"boolean"==typeof n&&(i=n,n=void 0),s._isAMomentObject=!0,s._useUTC=s._isUTC=o,s._l=n,s._i=t,s._f=e,s._strict=i,St(s)}function Ot(t,e,n,i){return Pt(t,e,n,i,!1)}function At(t,e){var n,i;if(1===e.length&&o(e[0])&&(e=e[0]),!e.length)return Ot();for(n=e[0],i=1;i<e.length;++i)(!e[i].isValid()||e[i][t](n))&&(n=e[i]);return n}function Et(){var t=[].slice.call(arguments,0);return At("isBefore",t)}function zt(){var t=[].slice.call(arguments,0);return At("isAfter",t)}function Yt(t){var e=C(t),n=e.year||0,i=e.quarter||0,o=e.month||0,s=e.week||0,r=e.day||0,a=e.hour||0,l=e.minute||0,u=e.second||0,c=e.millisecond||0;
this._milliseconds=+c+1e3*u+6e4*l+36e5*a,this._days=+r+7*s,this._months=+o+3*i+12*n,this._data={},this._locale=D(),this._bubble()}function Nt(t){return t instanceof Yt}function $t(t,e){Y(t,0,0,function(){var t=this.utcOffset(),n="+";return 0>t&&(t=-t,n="-"),n+z(~~(t/60),2)+e+z(~~t%60,2)})}function It(t){var e=(t||"").match(ii)||[],n=e[e.length-1]||[],i=(n+"").match(Di)||["-",0,0],o=+(60*i[1])+_(i[2]);return"+"===i[0]?o:-o}function Rt(t,e){var i,o;return e._isUTC?(i=e.clone(),o=(g(t)||s(t)?+t:+Ot(t))-+i,i._d.setTime(+i._d+o),n.updateOffset(i,!1),i):Ot(t).local()}function Ft(t){return 15*-Math.round(t._d.getTimezoneOffset()/15)}function jt(t,e){var i,o=this._offset||0;return null!=t?("string"==typeof t&&(t=It(t)),Math.abs(t)<16&&(t=60*t),!this._isUTC&&e&&(i=Ft(this)),this._offset=t,this._isUTC=!0,null!=i&&this.add(i,"m"),o!==t&&(!e||this._changeInProgress?ie(this,Kt(t-o,"m"),1,!1):this._changeInProgress||(this._changeInProgress=!0,n.updateOffset(this,!0),this._changeInProgress=null)),this):this._isUTC?o:Ft(this)}function Bt(t,e){return null!=t?("string"!=typeof t&&(t=-t),this.utcOffset(t,e),this):-this.utcOffset()}function Ut(t){return this.utcOffset(0,t)}function Wt(t){return this._isUTC&&(this.utcOffset(0,t),this._isUTC=!1,t&&this.subtract(Ft(this),"m")),this}function Ht(){return this._tzm?this.utcOffset(this._tzm):"string"==typeof this._i&&this.utcOffset(It(this._i)),this}function Vt(t){return t=t?Ot(t).utcOffset():0,(this.utcOffset()-t)%60===0}function Gt(){return this.utcOffset()>this.clone().month(0).utcOffset()||this.utcOffset()>this.clone().month(5).utcOffset()}function Zt(){if("undefined"!=typeof this._isDSTShifted)return this._isDSTShifted;var t={};if(f(t,this),t=Tt(t),t._a){var e=t._isUTC?u(t._a):Ot(t._a);this._isDSTShifted=this.isValid()&&y(t._a,e.toArray())>0}else this._isDSTShifted=!1;return this._isDSTShifted}function qt(){return!this._isUTC}function Jt(){return this._isUTC}function Xt(){return this._isUTC&&0===this._offset}function Kt(t,e){var n,i,o,s=t,r=null;return Nt(t)?s={ms:t._milliseconds,d:t._days,M:t._months}:"number"==typeof t?(s={},e?s[e]=t:s.milliseconds=t):(r=Si.exec(t))?(n="-"===r[1]?-1:1,s={y:0,d:_(r[ci])*n,h:_(r[hi])*n,m:_(r[di])*n,s:_(r[pi])*n,ms:_(r[fi])*n}):(r=Ti.exec(t))?(n="-"===r[1]?-1:1,s={y:Qt(r[2],n),M:Qt(r[3],n),d:Qt(r[4],n),h:Qt(r[5],n),m:Qt(r[6],n),s:Qt(r[7],n),w:Qt(r[8],n)}):null==s?s={}:"object"==typeof s&&("from"in s||"to"in s)&&(o=ee(Ot(s.from),Ot(s.to)),s={},s.ms=o.milliseconds,s.M=o.months),i=new Yt(s),Nt(t)&&a(t,"_locale")&&(i._locale=t._locale),i}function Qt(t,e){var n=t&&parseFloat(t.replace(",","."));return(isNaN(n)?0:n)*e}function te(t,e){var n={milliseconds:0,months:0};return n.months=e.month()-t.month()+12*(e.year()-t.year()),t.clone().add(n.months,"M").isAfter(e)&&--n.months,n.milliseconds=+e-+t.clone().add(n.months,"M"),n}function ee(t,e){var n;return e=Rt(e,t),t.isBefore(e)?n=te(t,e):(n=te(e,t),n.milliseconds=-n.milliseconds,n.months=-n.months),n}function ne(t,e){return function(n,i){var o,s;return null===i||isNaN(+i)||(it(e,"moment()."+e+"(period, number) is deprecated. Please use moment()."+e+"(number, period)."),s=n,n=i,i=s),n="string"==typeof n?+n:n,o=Kt(n,i),ie(this,o,t),this}}function ie(t,e,i,o){var s=e._milliseconds,r=e._days,a=e._months;o=null==o?!0:o,s&&t._d.setTime(+t._d+s*i),r&&A(t,"Date",O(t,"Date")+r*i),a&&X(t,O(t,"Month")+a*i),o&&n.updateOffset(t,r||a)}function oe(t,e){var n=t||Ot(),i=Rt(n,this).startOf("day"),o=this.diff(i,"days",!0),s=-6>o?"sameElse":-1>o?"lastWeek":0>o?"lastDay":1>o?"sameDay":2>o?"nextDay":7>o?"nextWeek":"sameElse";return this.format(e&&e[s]||this.localeData().calendar(s,this,Ot(n)))}function se(){return new m(this)}function re(t,e){var n;return e=T("undefined"!=typeof e?e:"millisecond"),"millisecond"===e?(t=g(t)?t:Ot(t),+this>+t):(n=g(t)?+t:+Ot(t),n<+this.clone().startOf(e))}function ae(t,e){var n;return e=T("undefined"!=typeof e?e:"millisecond"),"millisecond"===e?(t=g(t)?t:Ot(t),+t>+this):(n=g(t)?+t:+Ot(t),+this.clone().endOf(e)<n)}function le(t,e,n){return this.isAfter(t,n)&&this.isBefore(e,n)}function ue(t,e){var n;return e=T(e||"millisecond"),"millisecond"===e?(t=g(t)?t:Ot(t),+this===+t):(n=+Ot(t),+this.clone().startOf(e)<=n&&n<=+this.clone().endOf(e))}function ce(t,e,n){var i,o,s=Rt(t,this),r=6e4*(s.utcOffset()-this.utcOffset());return e=T(e),"year"===e||"month"===e||"quarter"===e?(o=he(this,s),"quarter"===e?o/=3:"year"===e&&(o/=12)):(i=this-s,o="second"===e?i/1e3:"minute"===e?i/6e4:"hour"===e?i/36e5:"day"===e?(i-r)/864e5:"week"===e?(i-r)/6048e5:i),n?o:v(o)}function he(t,e){var n,i,o=12*(e.year()-t.year())+(e.month()-t.month()),s=t.clone().add(o,"months");return 0>e-s?(n=t.clone().add(o-1,"months"),i=(e-s)/(s-n)):(n=t.clone().add(o+1,"months"),i=(e-s)/(n-s)),-(o+i)}function de(){return this.clone().locale("en").format("ddd MMM DD YYYY HH:mm:ss [GMT]ZZ")}function pe(){var t=this.clone().utc();return 0<t.year()&&t.year()<=9999?"function"==typeof Date.prototype.toISOString?this.toDate().toISOString():I(t,"YYYY-MM-DD[T]HH:mm:ss.SSS[Z]"):I(t,"YYYYYY-MM-DD[T]HH:mm:ss.SSS[Z]")}function fe(t){var e=I(this,t||n.defaultFormat);return this.localeData().postformat(e)}function me(t,e){return this.isValid()?Kt({to:this,from:t}).locale(this.locale()).humanize(!e):this.localeData().invalidDate()}function ge(t){return this.from(Ot(),t)}function ve(t,e){return this.isValid()?Kt({from:this,to:t}).locale(this.locale()).humanize(!e):this.localeData().invalidDate()}function _e(t){return this.to(Ot(),t)}function ye(t){var e;return void 0===t?this._locale._abbr:(e=D(t),null!=e&&(this._locale=e),this)}function be(){return this._locale}function we(t){switch(t=T(t)){case"year":this.month(0);case"quarter":case"month":this.date(1);case"week":case"isoWeek":case"day":this.hours(0);case"hour":this.minutes(0);case"minute":this.seconds(0);case"second":this.milliseconds(0)}return"week"===t&&this.weekday(0),"isoWeek"===t&&this.isoWeekday(1),"quarter"===t&&this.month(3*Math.floor(this.month()/3)),this}function Me(t){return t=T(t),void 0===t||"millisecond"===t?this:this.startOf(t).add(1,"isoWeek"===t?"week":t).subtract(1,"ms")}function Le(){return+this._d-6e4*(this._offset||0)}function ke(){return Math.floor(+this/1e3)}function xe(){return this._offset?new Date(+this):this._d}function De(){var t=this;return[t.year(),t.month(),t.date(),t.hour(),t.minute(),t.second(),t.millisecond()]}function Se(){var t=this;return{years:t.year(),months:t.month(),date:t.date(),hours:t.hours(),minutes:t.minutes(),seconds:t.seconds(),milliseconds:t.milliseconds()}}function Te(){return d(this)}function Ce(){return l({},h(this))}function Pe(){return h(this).overflow}function Oe(t,e){Y(0,[t,t.length],0,e)}function Ae(t,e,n){return ht(Ot([t,11,31+e-n]),e,n).week}function Ee(t){var e=ht(this,this.localeData()._week.dow,this.localeData()._week.doy).year;return null==t?e:this.add(t-e,"y")}function ze(t){var e=ht(this,1,4).year;return null==t?e:this.add(t-e,"y")}function Ye(){return Ae(this.year(),1,4)}function Ne(){var t=this.localeData()._week;return Ae(this.year(),t.dow,t.doy)}function $e(t){return null==t?Math.ceil((this.month()+1)/3):this.month(3*(t-1)+this.month()%3)}function Ie(t,e){return"string"!=typeof t?t:isNaN(t)?(t=e.weekdaysParse(t),"number"==typeof t?t:null):parseInt(t,10)}function Re(t){return this._weekdays[t.day()]}function Fe(t){return this._weekdaysShort[t.day()]}function je(t){return this._weekdaysMin[t.day()]}function Be(t){var e,n,i;for(this._weekdaysParse=this._weekdaysParse||[],e=0;7>e;e++)if(this._weekdaysParse[e]||(n=Ot([2e3,1]).day(e),i="^"+this.weekdays(n,"")+"|^"+this.weekdaysShort(n,"")+"|^"+this.weekdaysMin(n,""),this._weekdaysParse[e]=new RegExp(i.replace(".",""),"i")),this._weekdaysParse[e].test(t))return e}function Ue(t){var e=this._isUTC?this._d.getUTCDay():this._d.getDay();return null!=t?(t=Ie(t,this.localeData()),this.add(t-e,"d")):e}function We(t){var e=(this.day()+7-this.localeData()._week.dow)%7;return null==t?e:this.add(t-e,"d")}function He(t){return null==t?this.day()||7:this.day(this.day()%7?t:t-7)}function Ve(t,e){Y(t,0,0,function(){return this.localeData().meridiem(this.hours(),this.minutes(),e)})}function Ge(t,e){return e._meridiemParse}function Ze(t){return"p"===(t+"").toLowerCase().charAt(0)}function qe(t,e,n){return t>11?n?"pm":"PM":n?"am":"AM"}function Je(t,e){e[fi]=_(1e3*("0."+t))}function Xe(){return this._isUTC?"UTC":""}function Ke(){return this._isUTC?"Coordinated Universal Time":""}function Qe(t){return Ot(1e3*t)}function tn(){return Ot.apply(null,arguments).parseZone()}function en(t,e,n){var i=this._calendar[t];return"function"==typeof i?i.call(e,n):i}function nn(t){var e=this._longDateFormat[t],n=this._longDateFormat[t.toUpperCase()];return e||!n?e:(this._longDateFormat[t]=n.replace(/MMMM|MM|DD|dddd/g,function(t){return t.slice(1)}),this._longDateFormat[t])}function on(){return this._invalidDate}function sn(t){return this._ordinal.replace("%d",t)}function rn(t){return t}function an(t,e,n,i){var o=this._relativeTime[n];return"function"==typeof o?o(t,e,n,i):o.replace(/%d/i,t)}function ln(t,e){var n=this._relativeTime[t>0?"future":"past"];return"function"==typeof n?n(e):n.replace(/%s/i,e)}function un(t){var e,n;for(n in t)e=t[n],"function"==typeof e?this[n]=e:this["_"+n]=e;this._ordinalParseLenient=new RegExp(this._ordinalParse.source+"|"+/\d{1,2}/.source)}function cn(t,e,n,i){var o=D(),s=u().set(i,e);return o[n](s,t)}function hn(t,e,n,i,o){if("number"==typeof t&&(e=t,t=void 0),t=t||"",null!=e)return cn(t,e,n,o);var s,r=[];for(s=0;i>s;s++)r[s]=cn(t,s,n,o);return r}function dn(t,e){return hn(t,e,"months",12,"month")}function pn(t,e){return hn(t,e,"monthsShort",12,"month")}function fn(t,e){return hn(t,e,"weekdays",7,"day")}function mn(t,e){return hn(t,e,"weekdaysShort",7,"day")}function gn(t,e){return hn(t,e,"weekdaysMin",7,"day")}function vn(){var t=this._data;return this._milliseconds=Xi(this._milliseconds),this._days=Xi(this._days),this._months=Xi(this._months),t.milliseconds=Xi(t.milliseconds),t.seconds=Xi(t.seconds),t.minutes=Xi(t.minutes),t.hours=Xi(t.hours),t.months=Xi(t.months),t.years=Xi(t.years),this}function _n(t,e,n,i){var o=Kt(e,n);return t._milliseconds+=i*o._milliseconds,t._days+=i*o._days,t._months+=i*o._months,t._bubble()}function yn(t,e){return _n(this,t,e,1)}function bn(t,e){return _n(this,t,e,-1)}function wn(t){return 0>t?Math.floor(t):Math.ceil(t)}function Mn(){var t,e,n,i,o,s=this._milliseconds,r=this._days,a=this._months,l=this._data;return s>=0&&r>=0&&a>=0||0>=s&&0>=r&&0>=a||(s+=864e5*wn(kn(a)+r),r=0,a=0),l.milliseconds=s%1e3,t=v(s/1e3),l.seconds=t%60,e=v(t/60),l.minutes=e%60,n=v(e/60),l.hours=n%24,r+=v(n/24),o=v(Ln(r)),a+=o,r-=wn(kn(o)),i=v(a/12),a%=12,l.days=r,l.months=a,l.years=i,this}function Ln(t){return 4800*t/146097}function kn(t){return 146097*t/4800}function xn(t){var e,n,i=this._milliseconds;if(t=T(t),"month"===t||"year"===t)return e=this._days+i/864e5,n=this._months+Ln(e),"month"===t?n:n/12;switch(e=this._days+Math.round(kn(this._months)),t){case"week":return e/7+i/6048e5;case"day":return e+i/864e5;case"hour":return 24*e+i/36e5;case"minute":return 1440*e+i/6e4;case"second":return 86400*e+i/1e3;case"millisecond":return Math.floor(864e5*e)+i;default:throw new Error("Unknown unit "+t)}}function Dn(){return this._milliseconds+864e5*this._days+this._months%12*2592e6+31536e6*_(this._months/12)}function Sn(t){return function(){return this.as(t)}}function Tn(t){return t=T(t),this[t+"s"]()}function Cn(t){return function(){return this._data[t]}}function Pn(){return v(this.days()/7)}function On(t,e,n,i,o){return o.relativeTime(e||1,!!n,t,i)}function An(t,e,n){var i=Kt(t).abs(),o=fo(i.as("s")),s=fo(i.as("m")),r=fo(i.as("h")),a=fo(i.as("d")),l=fo(i.as("M")),u=fo(i.as("y")),c=o<mo.s&&["s",o]||1===s&&["m"]||s<mo.m&&["mm",s]||1===r&&["h"]||r<mo.h&&["hh",r]||1===a&&["d"]||a<mo.d&&["dd",a]||1===l&&["M"]||l<mo.M&&["MM",l]||1===u&&["y"]||["yy",u];return c[2]=e,c[3]=+t>0,c[4]=n,On.apply(null,c)}function En(t,e){return void 0===mo[t]?!1:void 0===e?mo[t]:(mo[t]=e,!0)}function zn(t){var e=this.localeData(),n=An(this,!t,e);return t&&(n=e.pastFuture(+this,n)),e.postformat(n)}function Yn(){var t,e,n,i=go(this._milliseconds)/1e3,o=go(this._days),s=go(this._months);t=v(i/60),e=v(t/60),i%=60,t%=60,n=v(s/12),s%=12;var r=n,a=s,l=o,u=e,c=t,h=i,d=this.asSeconds();return d?(0>d?"-":"")+"P"+(r?r+"Y":"")+(a?a+"M":"")+(l?l+"D":"")+(u||c||h?"T":"")+(u?u+"H":"")+(c?c+"M":"")+(h?h+"S":""):"P0D"}var Nn,$n,In=n.momentProperties=[],Rn=!1,Fn={},jn={},Bn=/(\[[^\[]*\])|(\\)?(Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|Q|YYYYYY|YYYYY|YYYY|YY|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|mm?|ss?|S{1,9}|x|X|zz?|ZZ?|.)/g,Un=/(\[[^\[]*\])|(\\)?(LTS|LT|LL?L?L?|l{1,4})/g,Wn={},Hn={},Vn=/\d/,Gn=/\d\d/,Zn=/\d{3}/,qn=/\d{4}/,Jn=/[+-]?\d{6}/,Xn=/\d\d?/,Kn=/\d{1,3}/,Qn=/\d{1,4}/,ti=/[+-]?\d{1,6}/,ei=/\d+/,ni=/[+-]?\d+/,ii=/Z|[+-]\d\d:?\d\d/gi,oi=/[+-]?\d+(\.\d{1,3})?/,si=/[0-9]*['a-z\u00A0-\u05FF\u0700-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+|[\u0600-\u06FF\/]+(\s*?[\u0600-\u06FF]+){1,2}/i,ri={},ai={},li=0,ui=1,ci=2,hi=3,di=4,pi=5,fi=6;Y("M",["MM",2],"Mo",function(){return this.month()+1}),Y("MMM",0,0,function(t){return this.localeData().monthsShort(this,t)}),Y("MMMM",0,0,function(t){return this.localeData().months(this,t)}),S("month","M"),j("M",Xn),j("MM",Xn,Gn),j("MMM",si),j("MMMM",si),W(["M","MM"],function(t,e){e[ui]=_(t)-1}),W(["MMM","MMMM"],function(t,e,n,i){var o=n._locale.monthsParse(t,i,n._strict);null!=o?e[ui]=o:h(n).invalidMonth=t});var mi="January_February_March_April_May_June_July_August_September_October_November_December".split("_"),gi="Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),vi={};n.suppressDeprecationWarnings=!1;var _i=/^\s*(?:[+-]\d{6}|\d{4})-(?:(\d\d-\d\d)|(W\d\d$)|(W\d\d-\d)|(\d\d\d))((T| )(\d\d(:\d\d(:\d\d(\.\d+)?)?)?)?([\+\-]\d\d(?::?\d\d)?|\s*Z)?)?$/,yi=[["YYYYYY-MM-DD",/[+-]\d{6}-\d{2}-\d{2}/],["YYYY-MM-DD",/\d{4}-\d{2}-\d{2}/],["GGGG-[W]WW-E",/\d{4}-W\d{2}-\d/],["GGGG-[W]WW",/\d{4}-W\d{2}/],["YYYY-DDD",/\d{4}-\d{3}/]],bi=[["HH:mm:ss.SSSS",/(T| )\d\d:\d\d:\d\d\.\d+/],["HH:mm:ss",/(T| )\d\d:\d\d:\d\d/],["HH:mm",/(T| )\d\d:\d\d/],["HH",/(T| )\d\d/]],wi=/^\/?Date\((\-?\d+)/i;n.createFromInputFallback=nt("moment construction falls back to js Date. This is discouraged and will be removed in upcoming major release. Please refer to https://github.com/moment/moment/issues/1407 for more info.",function(t){t._d=new Date(t._i+(t._useUTC?" UTC":""))}),Y(0,["YY",2],0,function(){return this.year()%100}),Y(0,["YYYY",4],0,"year"),Y(0,["YYYYY",5],0,"year"),Y(0,["YYYYYY",6,!0],0,"year"),S("year","y"),j("Y",ni),j("YY",Xn,Gn),j("YYYY",Qn,qn),j("YYYYY",ti,Jn),j("YYYYYY",ti,Jn),W(["YYYYY","YYYYYY"],li),W("YYYY",function(t,e){e[li]=2===t.length?n.parseTwoDigitYear(t):_(t)}),W("YY",function(t,e){e[li]=n.parseTwoDigitYear(t)}),n.parseTwoDigitYear=function(t){return _(t)+(_(t)>68?1900:2e3)};var Mi=P("FullYear",!1);Y("w",["ww",2],"wo","week"),Y("W",["WW",2],"Wo","isoWeek"),S("week","w"),S("isoWeek","W"),j("w",Xn),j("ww",Xn,Gn),j("W",Xn),j("WW",Xn,Gn),H(["w","ww","W","WW"],function(t,e,n,i){e[i.substr(0,1)]=_(t)});var Li={dow:0,doy:6};Y("DDD",["DDDD",3],"DDDo","dayOfYear"),S("dayOfYear","DDD"),j("DDD",Kn),j("DDDD",Zn),W(["DDD","DDDD"],function(t,e,n){n._dayOfYear=_(t)}),n.ISO_8601=function(){};var ki=nt("moment().min is deprecated, use moment.min instead. https://github.com/moment/moment/issues/1548",function(){var t=Ot.apply(null,arguments);return this>t?this:t}),xi=nt("moment().max is deprecated, use moment.max instead. https://github.com/moment/moment/issues/1548",function(){var t=Ot.apply(null,arguments);return t>this?this:t});$t("Z",":"),$t("ZZ",""),j("Z",ii),j("ZZ",ii),W(["Z","ZZ"],function(t,e,n){n._useUTC=!0,n._tzm=It(t)});var Di=/([\+\-]|\d\d)/gi;n.updateOffset=function(){};var Si=/(\-)?(?:(\d*)\.)?(\d+)\:(\d+)(?:\:(\d+)\.?(\d{3})?)?/,Ti=/^(-)?P(?:(?:([0-9,.]*)Y)?(?:([0-9,.]*)M)?(?:([0-9,.]*)D)?(?:T(?:([0-9,.]*)H)?(?:([0-9,.]*)M)?(?:([0-9,.]*)S)?)?|([0-9,.]*)W)$/;Kt.fn=Yt.prototype;var Ci=ne(1,"add"),Pi=ne(-1,"subtract");n.defaultFormat="YYYY-MM-DDTHH:mm:ssZ";var Oi=nt("moment().lang() is deprecated. Instead, use moment().localeData() to get the language configuration. Use moment().locale() to change languages.",function(t){return void 0===t?this.localeData():this.locale(t)});Y(0,["gg",2],0,function(){return this.weekYear()%100}),Y(0,["GG",2],0,function(){return this.isoWeekYear()%100}),Oe("gggg","weekYear"),Oe("ggggg","weekYear"),Oe("GGGG","isoWeekYear"),Oe("GGGGG","isoWeekYear"),S("weekYear","gg"),S("isoWeekYear","GG"),j("G",ni),j("g",ni),j("GG",Xn,Gn),j("gg",Xn,Gn),j("GGGG",Qn,qn),j("gggg",Qn,qn),j("GGGGG",ti,Jn),j("ggggg",ti,Jn),H(["gggg","ggggg","GGGG","GGGGG"],function(t,e,n,i){e[i.substr(0,2)]=_(t)}),H(["gg","GG"],function(t,e,i,o){e[o]=n.parseTwoDigitYear(t)}),Y("Q",0,0,"quarter"),S("quarter","Q"),j("Q",Vn),W("Q",function(t,e){e[ui]=3*(_(t)-1)}),Y("D",["DD",2],"Do","date"),S("date","D"),j("D",Xn),j("DD",Xn,Gn),j("Do",function(t,e){return t?e._ordinalParse:e._ordinalParseLenient}),W(["D","DD"],ci),W("Do",function(t,e){e[ci]=_(t.match(Xn)[0],10)});var Ai=P("Date",!0);Y("d",0,"do","day"),Y("dd",0,0,function(t){return this.localeData().weekdaysMin(this,t)}),Y("ddd",0,0,function(t){return this.localeData().weekdaysShort(this,t)}),Y("dddd",0,0,function(t){return this.localeData().weekdays(this,t)}),Y("e",0,0,"weekday"),Y("E",0,0,"isoWeekday"),S("day","d"),S("weekday","e"),S("isoWeekday","E"),j("d",Xn),j("e",Xn),j("E",Xn),j("dd",si),j("ddd",si),j("dddd",si),H(["dd","ddd","dddd"],function(t,e,n){var i=n._locale.weekdaysParse(t);null!=i?e.d=i:h(n).invalidWeekday=t}),H(["d","e","E"],function(t,e,n,i){e[i]=_(t)});var Ei="Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),zi="Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),Yi="Su_Mo_Tu_We_Th_Fr_Sa".split("_");Y("H",["HH",2],0,"hour"),Y("h",["hh",2],0,function(){return this.hours()%12||12}),Ve("a",!0),Ve("A",!1),S("hour","h"),j("a",Ge),j("A",Ge),j("H",Xn),j("h",Xn),j("HH",Xn,Gn),j("hh",Xn,Gn),W(["H","HH"],hi),W(["a","A"],function(t,e,n){n._isPm=n._locale.isPM(t),n._meridiem=t}),W(["h","hh"],function(t,e,n){e[hi]=_(t),h(n).bigHour=!0});var Ni=/[ap]\.?m?\.?/i,$i=P("Hours",!0);Y("m",["mm",2],0,"minute"),S("minute","m"),j("m",Xn),j("mm",Xn,Gn),W(["m","mm"],di);var Ii=P("Minutes",!1);Y("s",["ss",2],0,"second"),S("second","s"),j("s",Xn),j("ss",Xn,Gn),W(["s","ss"],pi);var Ri=P("Seconds",!1);Y("S",0,0,function(){return~~(this.millisecond()/100)}),Y(0,["SS",2],0,function(){return~~(this.millisecond()/10)}),Y(0,["SSS",3],0,"millisecond"),Y(0,["SSSS",4],0,function(){return 10*this.millisecond()}),Y(0,["SSSSS",5],0,function(){return 100*this.millisecond()}),Y(0,["SSSSSS",6],0,function(){return 1e3*this.millisecond()}),Y(0,["SSSSSSS",7],0,function(){return 1e4*this.millisecond()}),Y(0,["SSSSSSSS",8],0,function(){return 1e5*this.millisecond()}),Y(0,["SSSSSSSSS",9],0,function(){return 1e6*this.millisecond()}),S("millisecond","ms"),j("S",Kn,Vn),j("SS",Kn,Gn),j("SSS",Kn,Zn);var Fi;for(Fi="SSSS";Fi.length<=9;Fi+="S")j(Fi,ei);for(Fi="S";Fi.length<=9;Fi+="S")W(Fi,Je);var ji=P("Milliseconds",!1);Y("z",0,0,"zoneAbbr"),Y("zz",0,0,"zoneName");var Bi=m.prototype;Bi.add=Ci,Bi.calendar=oe,Bi.clone=se,Bi.diff=ce,Bi.endOf=Me,Bi.format=fe,Bi.from=me,Bi.fromNow=ge,Bi.to=ve,Bi.toNow=_e,Bi.get=E,Bi.invalidAt=Pe,Bi.isAfter=re,Bi.isBefore=ae,Bi.isBetween=le,Bi.isSame=ue,Bi.isValid=Te,Bi.lang=Oi,Bi.locale=ye,Bi.localeData=be,Bi.max=xi,Bi.min=ki,Bi.parsingFlags=Ce,Bi.set=E,Bi.startOf=we,Bi.subtract=Pi,Bi.toArray=De,Bi.toObject=Se,Bi.toDate=xe,Bi.toISOString=pe,Bi.toJSON=pe,Bi.toString=de,Bi.unix=ke,Bi.valueOf=Le,Bi.year=Mi,Bi.isLeapYear=ct,Bi.weekYear=Ee,Bi.isoWeekYear=ze,Bi.quarter=Bi.quarters=$e,Bi.month=K,Bi.daysInMonth=Q,Bi.week=Bi.weeks=mt,Bi.isoWeek=Bi.isoWeeks=gt,Bi.weeksInYear=Ne,Bi.isoWeeksInYear=Ye,Bi.date=Ai,Bi.day=Bi.days=Ue,Bi.weekday=We,Bi.isoWeekday=He,Bi.dayOfYear=_t,Bi.hour=Bi.hours=$i,Bi.minute=Bi.minutes=Ii,Bi.second=Bi.seconds=Ri,Bi.millisecond=Bi.milliseconds=ji,Bi.utcOffset=jt,Bi.utc=Ut,Bi.local=Wt,Bi.parseZone=Ht,Bi.hasAlignedHourOffset=Vt,Bi.isDST=Gt,Bi.isDSTShifted=Zt,Bi.isLocal=qt,Bi.isUtcOffset=Jt,Bi.isUtc=Xt,Bi.isUTC=Xt,Bi.zoneAbbr=Xe,Bi.zoneName=Ke,Bi.dates=nt("dates accessor is deprecated. Use date instead.",Ai),Bi.months=nt("months accessor is deprecated. Use month instead",K),Bi.years=nt("years accessor is deprecated. Use year instead",Mi),Bi.zone=nt("moment().zone is deprecated, use moment().utcOffset instead. https://github.com/moment/moment/issues/1779",Bt);var Ui=Bi,Wi={sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"},Hi={LTS:"h:mm:ss A",LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D, YYYY",LLL:"MMMM D, YYYY h:mm A",LLLL:"dddd, MMMM D, YYYY h:mm A"},Vi="Invalid date",Gi="%d",Zi=/\d{1,2}/,qi={future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},Ji=b.prototype;Ji._calendar=Wi,Ji.calendar=en,Ji._longDateFormat=Hi,Ji.longDateFormat=nn,Ji._invalidDate=Vi,Ji.invalidDate=on,Ji._ordinal=Gi,Ji.ordinal=sn,Ji._ordinalParse=Zi,Ji.preparse=rn,Ji.postformat=rn,Ji._relativeTime=qi,Ji.relativeTime=an,Ji.pastFuture=ln,Ji.set=un,Ji.months=Z,Ji._months=mi,Ji.monthsShort=q,Ji._monthsShort=gi,Ji.monthsParse=J,Ji.week=dt,Ji._week=Li,Ji.firstDayOfYear=ft,Ji.firstDayOfWeek=pt,Ji.weekdays=Re,Ji._weekdays=Ei,Ji.weekdaysMin=je,Ji._weekdaysMin=Yi,Ji.weekdaysShort=Fe,Ji._weekdaysShort=zi,Ji.weekdaysParse=Be,Ji.isPM=Ze,Ji._meridiemParse=Ni,Ji.meridiem=qe,k("en",{ordinalParse:/\d{1,2}(th|st|nd|rd)/,ordinal:function(t){var e=t%10,n=1===_(t%100/10)?"th":1===e?"st":2===e?"nd":3===e?"rd":"th";return t+n}}),n.lang=nt("moment.lang is deprecated. Use moment.locale instead.",k),n.langData=nt("moment.langData is deprecated. Use moment.localeData instead.",D);var Xi=Math.abs,Ki=Sn("ms"),Qi=Sn("s"),to=Sn("m"),eo=Sn("h"),no=Sn("d"),io=Sn("w"),oo=Sn("M"),so=Sn("y"),ro=Cn("milliseconds"),ao=Cn("seconds"),lo=Cn("minutes"),uo=Cn("hours"),co=Cn("days"),ho=Cn("months"),po=Cn("years"),fo=Math.round,mo={s:45,m:45,h:22,d:26,M:11},go=Math.abs,vo=Yt.prototype;vo.abs=vn,vo.add=yn,vo.subtract=bn,vo.as=xn,vo.asMilliseconds=Ki,vo.asSeconds=Qi,vo.asMinutes=to,vo.asHours=eo,vo.asDays=no,vo.asWeeks=io,vo.asMonths=oo,vo.asYears=so,vo.valueOf=Dn,vo._bubble=Mn,vo.get=Tn,vo.milliseconds=ro,vo.seconds=ao,vo.minutes=lo,vo.hours=uo,vo.days=co,vo.weeks=Pn,vo.months=ho,vo.years=po,vo.humanize=zn,vo.toISOString=Yn,vo.toString=Yn,vo.toJSON=Yn,vo.locale=ye,vo.localeData=be,vo.toIsoString=nt("toIsoString() is deprecated. Please use toISOString() instead (notice the capitals)",Yn),vo.lang=Oi,Y("X",0,0,"unix"),Y("x",0,0,"valueOf"),j("x",ni),j("X",oi),W("X",function(t,e,n){n._d=new Date(1e3*parseFloat(t,10))}),W("x",function(t,e,n){n._d=new Date(_(t))}),n.version="2.10.6",i(Ot),n.fn=Ui,n.min=Et,n.max=zt,n.utc=u,n.unix=Qe,n.months=dn,n.isDate=s,n.locale=k,n.invalid=p,n.duration=Kt,n.isMoment=g,n.weekdays=fn,n.parseZone=tn,n.localeData=D,n.isDuration=Nt,n.monthsShort=pn,n.weekdaysMin=gn,n.defineLocale=x,n.weekdaysShort=mn,n.normalizeUnits=T,n.relativeTimeThreshold=En;var _o=n;return _o})},{}],84:[function(t,e,n){var i=t("./lodash.custom.js"),o=t("geojson-rewind"),s=t("./polygon_features.json"),r={};r=function(t,e){function n(t){function e(t){var e=i.clone(t);e.lat=t.center.lat,e.lon=t.center.lon,e.__is_center_placeholder=!0,r.push(e)}function n(t){function e(t,e,i){var o={type:"node",id:"_"+n.type+"/"+n.id+"bounds"+i,lat:t,lon:e};n.nodes.push(o.id),r.push(o)}var n=i.clone(t);n.nodes=[],e(n.bounds.minlat,n.bounds.minlon,1),e(n.bounds.maxlat,n.bounds.minlon,2),e(n.bounds.maxlat,n.bounds.maxlon,3),e(n.bounds.minlat,n.bounds.maxlon,4),n.nodes.push(n.nodes[0]),n.__is_bounds_placeholder=!0,l.push(n)}function o(t){function e(t,e,n){var i={type:"node",id:n,lat:t,lon:e,__is_uninteresting:!0};r.push(i)}i.isArray(t.nodes)||(t.nodes=t.geometry.map(function(t){return null!==t?"_anonymous@"+t.lat+"/"+t.lon:"_anonymous@unknown_location"})),t.geometry.forEach(function(n,i){n&&e(n.lat,n.lon,t.nodes[i])})}function s(t){function e(t,e,n){var i={type:"node",id:n,lat:t,lon:e};r.push(i)}function n(t,e){function n(t,e){var n={type:"node",id:"_anonymous@"+t+"/"+e,lat:t,lon:e,__is_uninteresting:!0};i.nodes.push(n.id),r.push(n)}if(!l.some(function(t){return"way"==t.type&&t.id==e})){var i={type:"way",id:e,nodes:[]};t.forEach(function(t){t?n(t.lat,t.lon):i.nodes.push(void 0)}),l.push(i)}}t.members.forEach(function(t,i){"node"==t.type?t.lat&&e(t.lat,t.lon,t.ref):"way"==t.type&&t.geometry&&n(t.geometry,t.ref)})}for(var r=new Array,l=new Array,u=new Array,c=0;c<t.elements.length;c++)switch(t.elements[c].type){case"node":var h=t.elements[c];r.push(h);break;case"way":var d=i.clone(t.elements[c]);d.nodes=i.clone(d.nodes),l.push(d),d.center&&e(d),d.geometry?o(d):d.bounds&&n(d);break;case"relation":var p=i.clone(t.elements[c]);p.members=i.clone(p.members),u.push(p);var f=p.members&&p.members.some(function(t){return"node"==t.type&&t.lat||"way"==t.type&&t.geometry&&t.geometry.length>0});p.center&&e(p),f?s(p):p.bounds&&n(p)}return a(r,l,u)}function r(t){function e(t,e,n){t.hasAttribute(n)&&(e[n]=t.getAttribute(n))}function n(t,n){var o=i.clone(t);e(n,o,"lat"),e(n,o,"lon"),o.__is_center_placeholder=!0,l.push(o)}function o(t,e){function n(t,e,n){var i={type:"node",id:"_"+o.type+"/"+o.id+"bounds"+n,lat:t,lon:e};o.nodes.push(i.id),l.push(i)}var o=i.clone(t);o.nodes=[],n(e.getAttribute("minlat"),e.getAttribute("minlon"),1),n(e.getAttribute("maxlat"),e.getAttribute("minlon"),2),n(e.getAttribute("maxlat"),e.getAttribute("maxlon"),3),n(e.getAttribute("minlat"),e.getAttribute("maxlon"),4),o.nodes.push(o.nodes[0]),o.__is_bounds_placeholder=!0,u.push(o)}function s(t,e){function n(t,e,n){var i={type:"node",id:n,lat:t,lon:e,__is_uninteresting:!0};return l.push(i),i.id}i.isArray(t.nodes)||(t.nodes=[],i.each(e,function(e,n){t.nodes.push("_anonymous@"+e.getAttribute("lat")+"/"+e.getAttribute("lon"))})),i.each(e,function(e,i){e.getAttribute("lat")&&n(e.getAttribute("lat"),e.getAttribute("lon"),t.nodes[i])})}function r(t,e){function n(t,e,n){var i={type:"node",id:n,lat:t,lon:e};l.push(i)}function o(t,e){function n(t,e){var n={type:"node",id:"_anonymous@"+t+"/"+e,lat:t,lon:e,__is_uninteresting:!0};o.nodes.push(n.id),l.push(n)}if(!u.some(function(t){return"way"==t.type&&t.id==e})){var o={type:"way",id:e,nodes:[]};i.each(t,function(t){t.getAttribute("lat")?n(t.getAttribute("lat"),t.getAttribute("lon")):o.nodes.push(void 0)}),u.push(o)}}i.each(e,function(e,i){"node"==t.members[i].type?e.getAttribute("lat")&&n(e.getAttribute("lat"),e.getAttribute("lon"),t.members[i].ref):"way"==t.members[i].type&&e.getElementsByTagName("nd").length>0&&o(e.getElementsByTagName("nd"),t.members[i].ref)})}var l=new Array,u=new Array,c=new Array;i.each(t.getElementsByTagName("node"),function(t,n){var o={};i.each(t.getElementsByTagName("tag"),function(t){o[t.getAttribute("k")]=t.getAttribute("v")});var s={type:"node"};e(t,s,"id"),e(t,s,"lat"),e(t,s,"lon"),e(t,s,"version"),e(t,s,"timestamp"),e(t,s,"changeset"),e(t,s,"uid"),e(t,s,"user"),i.isEmpty(o)||(s.tags=o),l.push(s)});var h,d;return i.each(t.getElementsByTagName("way"),function(t,r){var a={},l=[];i.each(t.getElementsByTagName("tag"),function(t){a[t.getAttribute("k")]=t.getAttribute("v")});var c=!1;i.each(t.getElementsByTagName("nd"),function(t,e){var n;(n=t.getAttribute("ref"))&&(l[e]=n),!c&&t.getAttribute("lat")&&(c=!0)});var p={type:"way"};e(t,p,"id"),e(t,p,"version"),e(t,p,"timestamp"),e(t,p,"changeset"),e(t,p,"uid"),e(t,p,"user"),l.length>0&&(p.nodes=l),i.isEmpty(a)||(p.tags=a),(h=t.getElementsByTagName("center")[0])&&n(p,h),c?s(p,t.getElementsByTagName("nd")):(d=t.getElementsByTagName("bounds")[0])&&o(p,d),u.push(p)}),i.each(t.getElementsByTagName("relation"),function(t,s){var a={},l=[];i.each(t.getElementsByTagName("tag"),function(t){a[t.getAttribute("k")]=t.getAttribute("v")});var u=!1;i.each(t.getElementsByTagName("member"),function(t,n){l[n]={},e(t,l[n],"ref"),e(t,l[n],"role"),e(t,l[n],"type"),(!u&&"node"==l[n].type&&t.getAttribute("lat")||"way"==l[n].type&&t.getElementsByTagName("nd").length>0)&&(u=!0)});var p={type:"relation"};e(t,p,"id"),e(t,p,"version"),e(t,p,"timestamp"),e(t,p,"changeset"),e(t,p,"uid"),e(t,p,"user"),l.length>0&&(p.members=l),i.isEmpty(a)||(p.tags=a),(h=t.getElementsByTagName("center")[0])&&n(p,h),u?r(p,t.getElementsByTagName("member")):(d=t.getElementsByTagName("bounds")[0])&&o(p,d),c.push(p)}),a(l,u,c)}function a(t,n,s){function r(t,n){if("object"!=typeof n&&(n={}),"function"==typeof e.uninterestingTags)return!e.uninterestingTags(t,n);for(var i in t)if(e.uninterestingTags[i]!==!0&&n[i]!==!0&&n[i]!==t[i])return!0;return!1}function a(t){var e={timestamp:t.timestamp,version:t.version,changeset:t.changeset,user:t.user,uid:t.uid};for(k in e)void 0===e[k]&&delete e[k];return e}function u(t,n){function o(n){for(var i,o,s,r,a,l,c=function(t){return t[0]},h=function(t){return t[t.length-1]},d=[];n.length;)for(i=n.pop().nodes.slice(),d.push(i);n.length&&c(i)!==h(i);){for(o=c(i),s=h(i),r=0;r<n.length;r++){if(l=n[r].nodes,s===c(l)){a=i.push,l=l.slice(1);break}if(s===h(l)){a=i.push,l=l.slice(0,-1).reverse();break}if(o==h(l)){a=i.unshift,l=l.slice(0,-1);break}if(o==c(l)){a=i.unshift,l=l.slice(1).reverse();break}l=a=null}if(!l){e.verbose&&console.warn("Multipolygon",u+"/"+t.id,"contains unclosed ring geometry");break}n.splice(r,1),a.apply(i,l)}return d}function s(t){var e,n,i=function(t,e){for(var n=0;n<e.length;n++)if(s(e[n],t))return!0;return!1},o=function(t){return t.map(function(t){return[+t.lat,+t.lon]})},s=function(t,e){for(var n=t[0],i=t[1],o=!1,s=0,r=e.length-1;s<e.length;r=s++){var a=e[s][0],l=e[s][1],u=e[r][0],c=e[r][1],h=l>i!=c>i&&(u-a)*(i-l)/(c-l)+a>n;h&&(o=!o)}return o};for(t=o(t),e=0;e<c.length;e++)if(n=o(c[e]),i(n,t))return e}var r,l=!1,u=C?"way":"relation";r=n.members.filter(function(t){return"way"===t.type}),r=r.map(function(n){var i=f[n.ref];return void 0===i?(e.verbose&&console.warn("Multipolygon",u+"/"+t.id,"tainted by a missing way",n.type+"/"+n.ref),void(l=!0)):{id:n.ref,role:n.role||"outer",way:i,nodes:i.nodes.filter(function(i){return void 0!==i?!0:(l=!0,e.verbose&&console.warn("Multipolygon",u+"/"+t.id,"tainted by a way",n.type+"/"+n.ref,"with a missing node"),!1)})}}),r=i.compact(r);var c,h;c=o(r.filter(function(t){return"outer"===t.role})),h=o(r.filter(function(t){return"inner"===t.role}));var d;d=c.map(function(t){return[t]});for(var p=0;p<h.length;p++){var m=s(h[p]);void 0!==m?d[m].push(h[p]):e.verbose&&console.warn("Multipolygon",u+"/"+t.id,"contains an inner ring with no containing outer")}var g=[];if(g=i.compact(d.map(function(n){var o=i.compact(n.map(function(n){return n.length<4?void(e.verbose&&console.warn("Multipolygon",u+"/"+t.id,"contains a ring with less than four nodes")):i.compact(n.map(function(t){return[+t.lon,+t.lat]}))}));return 0==o.length?void(e.verbose&&console.warn("Multipolygon",u+"/"+t.id,"contains an empty ring cluster")):o})),0==g.length)return e.verbose&&console.warn("Multipolygon",u+"/"+t.id,"contains no coordinates"),!1;var v="MultiPolygon";1===g.length&&(v="Polygon",g=g[0]);var y={type:"Feature",id:t.type+"/"+t.id,properties:{type:t.type,id:t.id,tags:t.tags||{},relations:_[t.type][t.id]||[],meta:a(t)},geometry:{type:v,coordinates:g}};return l&&(e.verbose&&console.warn("Multipolygon",u+"/"+t.id,"is tainted"),y.properties.tainted=!0),y}for(var c=new Object,h=0;h<t.length;h++)void 0!==t[h].lat?c[t[h].id]=t[h]:e.verbose&&console.warn("Node",t[h].type+"/"+t[h].id,"ignored because it has no coordinates");for(var d=new Object,h=0;h<t.length;h++)"undefined"!=typeof t[h].tags&&r(t[h].tags)&&(d[t[h].id]=!0);for(var h=0;h<s.length;h++)if(i.isArray(s[h].members))for(var p=0;p<s[h].members.length;p++)"node"==s[h].members[p].type&&(d[s[h].members[p].ref]=!0);else e.verbose&&console.warn("Relation",s[h].type+"/"+s[h].id,"ignored because it has no members");for(var f=new Object,m=new Object,h=0;h<n.length;h++)if(i.isArray(n[h].nodes)){
f[n[h].id]=n[h];for(var p=0;p<n[h].nodes.length;p++)m[n[h].nodes[p]]=!0,n[h].nodes[p]=c[n[h].nodes[p]]}else e.verbose&&console.warn("Way",n[h].type+"/"+n[h].id,"ignored because it has no nodes");for(var g=new Array,h=0;h<t.length;h++)m[t[h].id]&&!d[t[h].id]||t[h].__is_uninteresting||g.push(t[h]);for(var v=new Array,h=0;h<s.length;h++)i.isArray(s[h].members)?v[s[h].id]=s[h]:e.verbose&&console.warn("Relation",s[h].type+"/"+s[h].id,"ignored because it has no members");for(var _={node:{},way:{},relation:{}},h=0;h<s.length;h++)if(i.isArray(s[h].members))for(var p=0;p<s[h].members.length;p++){var y;switch(s[h].members[p].type){case"node":y=c[s[h].members[p].ref];break;case"way":y=f[s[h].members[p].ref];break;case"relation":y=v[s[h].members[p].ref]}if(y){var b=s[h].members[p].type,w=s[h].members[p].ref;"undefined"==typeof _[b][w]&&(_[b][w]=[]),_[b][w].push({role:s[h].members[p].role,rel:s[h].id,reltags:s[h].tags})}else e.verbose&&console.warn("Relation",s[h].type+"/"+s[h].id,"member",s[h].members[p].type+"/"+s[h].members[p].id,"ignored because it has an invalid type")}else e.verbose&&console.warn("Relation",s[h].type+"/"+s[h].id,"ignored because it has no members");var M,L={type:"FeatureCollection",features:new Array};for(h=0;h<g.length;h++)if("undefined"!=typeof g[h].lon&&"undefined"!=typeof g[h].lat){var x={type:"Feature",id:g[h].type+"/"+g[h].id,properties:{type:g[h].type,id:g[h].id,tags:g[h].tags||{},relations:_.node[g[h].id]||[],meta:a(g[h])},geometry:{type:"Point",coordinates:[+g[h].lon,+g[h].lat]}};g[h].__is_center_placeholder&&(x.properties.geometry="center"),L.features.push(x)}else e.verbose&&console.warn("POI",g[h].type+"/"+g[h].id,"ignored because it lacks coordinates");for(var D={type:"FeatureCollection",features:new Array},S={type:"FeatureCollection",features:new Array},h=0;h<s.length;h++)if("undefined"!=typeof s[h].tags&&("multipolygon"==s[h].tags.type||"boundary"==s[h].tags.type)){if(!i.isArray(s[h].members)){e.verbose&&console.warn("Multipolygon",s[h].type+"/"+s[h].id,"ignored because it has no members");continue}for(var T=0,p=0;p<s[h].members.length;p++)"outer"==s[h].members[p].role?T++:e.verbose&&"inner"!=s[h].members[p].role&&console.warn("Multipolygon",s[h].type+"/"+s[h].id,"member",s[h].members[p].type+"/"+s[h].members[p].ref,'ignored because it has an invalid role: "'+s[h].members[p].role+'"');if(s[h].members.forEach(function(t){f[t.ref]&&("outer"!==t.role||r(f[t.ref].tags,s[h].tags)||(f[t.ref].is_multipolygon_outline=!0),"inner"!==t.role||r(f[t.ref].tags)||(f[t.ref].is_multipolygon_outline=!0))}),0==T){e.verbose&&console.warn("Multipolygon relation",s[h].type+"/"+s[h].id,"ignored because it has no outer ways");continue}var C=!1;1!=T||r(s[h].tags,{type:!0})||(C=!0);var x=null;if(C){var P=s[h].members.filter(function(t){return"outer"===t.role})[0];if(P=f[P.ref],void 0===P){e.verbose&&console.warn("Multipolygon relation",s[h].type+"/"+s[h].id,"ignored because outer way",P.type+"/"+P.ref,"is missing");continue}P.is_multipolygon_outline=!0,x=u(P,s[h])}else x=u(s[h],s[h]);if(x===!1){e.verbose&&console.warn("Multipolygon relation",s[h].type+"/"+s[h].id,"ignored because it has invalid geometry");continue}S.features.push(x)}for(var h=0;h<n.length;h++)if(i.isArray(n[h].nodes)){if(!n[h].is_multipolygon_outline){for(n[h].tainted=!1,n[h].hidden=!1,coords=new Array,p=0;p<n[h].nodes.length;p++)"object"==typeof n[h].nodes[p]?coords.push([+n[h].nodes[p].lon,+n[h].nodes[p].lat]):(e.verbose&&console.warn("Way",n[h].type+"/"+n[h].id,"is tainted by an invalid node"),n[h].tainted=!0);if(coords.length<=1)e.verbose&&console.warn("Way",n[h].type+"/"+n[h].id,"ignored because it contains too few nodes");else{var O="LineString";"undefined"!=typeof n[h].nodes[0]&&n[h].nodes[0]===n[h].nodes[n[h].nodes.length-1]&&("undefined"!=typeof n[h].tags&&l(n[h].tags)||n[h].__is_bounds_placeholder)&&(O="Polygon",coords=[coords]);var x={type:"Feature",id:n[h].type+"/"+n[h].id,properties:{type:n[h].type,id:n[h].id,tags:n[h].tags||{},relations:_.way[n[h].id]||[],meta:a(n[h])},geometry:{type:O,coordinates:coords}};n[h].tainted&&(e.verbose&&console.warn("Way",n[h].type+"/"+n[h].id,"is tainted"),x.properties.tainted=!0),n[h].__is_bounds_placeholder&&(x.properties.geometry="bounds"),"LineString"==O?D.features.push(x):S.features.push(x)}}}else e.verbose&&console.warn("Way",n[h].type+"/"+n[h].id,"ignored because it has no nodes");return M={type:"FeatureCollection",features:[]},M.features=M.features.concat(S.features),M.features=M.features.concat(D.features),M.features=M.features.concat(L.features),e.flatProperties&&M.features.forEach(function(t){t.properties=i.merge(t.properties.meta,t.properties.tags,{id:t.properties.type+"/"+t.properties.id})}),M=o(M,!0)}function l(t){var n=e.polygonFeatures;if("function"==typeof n)return n(t);if("no"===t.area)return!1;for(var i in t){var o=t[i],s=n[i];if("undefined"!=typeof s&&"no"!==o){if(s===!0)return!0;if(s.included_values&&s.included_values[o]===!0)return!0;if(s.excluded_values&&s.excluded_values[o]!==!0)return!0}}return!1}e=i.merge({verbose:!1,flatProperties:!1,uninterestingTags:{source:!0,source_ref:!0,"source:ref":!0,history:!0,attribution:!0,created_by:!0,"tiger:county":!0,"tiger:tlid":!0,"tiger:upload_uuid":!0},polygonFeatures:s},e);var u;return u="undefined"!=typeof XMLDocument&&t instanceof XMLDocument||"undefined"==typeof XMLDocument&&t.childNodes?r(t):n(t)},r.toGeojson=r,e.exports=r},{"./lodash.custom.js":85,"./polygon_features.json":89,"geojson-rewind":86}],85:[function(t,e,n){(function(t){(function(){function i(){return O.pop()||[]}function o(t){return"function"!=typeof t.toString&&"string"==typeof(t+"")}function s(t){t.length=0,O.length<E&&O.push(t)}function r(t,e,n){e||(e=0),"undefined"==typeof n&&(n=t?t.length:0);for(var i=-1,o=n-e||0,s=Array(0>o?0:o);++i<o;)s[i]=t[e+i];return s}function a(){}function l(t){function e(){if(i){var t=r(i);dt.apply(t,arguments)}if(this instanceof e){var s=c(n.prototype),a=n.apply(s,t||arguments);return M(a)?a:s}return n.apply(o,t||arguments)}var n=t[0],i=t[2],o=t[4];return Lt(e,t),e}function u(t,e,n,a,l){if(n){var c=n(t);if("undefined"!=typeof c)return c}var h=M(t);if(!h)return t;var d=at.call(t);if(!Z[d]||!wt.nodeClass&&o(t))return t;var p=yt[d];switch(d){case F:case j:return new p(+t);case W:case G:return new p(t);case V:return c=p(t.source,z.exec(t)),c.lastIndex=t.lastIndex,c}var f=kt(t);if(e){var m=!a;a||(a=i()),l||(l=i());for(var g=a.length;g--;)if(a[g]==t)return l[g];c=f?p(t.length):{}}else c=f?r(t):Ot({},t);return f&&(ht.call(t,"index")&&(c.index=t.index),ht.call(t,"input")&&(c.input=t.input)),e?(a.push(t),l.push(c),(f?Pt:Et)(t,function(t,i){c[i]=u(t,e,n,a,l)}),m&&(s(a),s(l)),c):c}function c(t,e){return M(t)?gt(t):{}}function h(t,e,n){if("function"!=typeof t)return C;if("undefined"==typeof e||!("prototype"in t))return t;var i=t.__bindData__;if("undefined"==typeof i&&(wt.funcNames&&(i=!t.name),i=i||!wt.funcDecomp,!i)){var o=ut.call(t);wt.funcNames||(i=!Y.test(o)),i||(i=N.test(o),Lt(t,i))}if(i===!1||i!==!0&&1&i[1])return t;switch(n){case 1:return function(n){return t.call(e,n)};case 2:return function(n,i){return t.call(e,n,i)};case 3:return function(n,i,o){return t.call(e,n,i,o)};case 4:return function(n,i,o,s){return t.call(e,n,i,o,s)}}return T(t,e)}function d(t){function e(){var t=u?a:this;if(o){var g=r(o);dt.apply(g,arguments)}if((s||p)&&(g||(g=r(arguments)),s&&dt.apply(g,s),p&&g.length<l))return i|=16,d([n,f?i:-4&i,g,null,a,l]);if(g||(g=arguments),h&&(n=t[m]),this instanceof e){t=c(n.prototype);var v=n.apply(t,g);return M(v)?v:t}return n.apply(t,g)}var n=t[0],i=t[1],o=t[2],s=t[3],a=t[4],l=t[5],u=1&i,h=2&i,p=4&i,f=8&i,m=n;return Lt(e,t),e}function p(t,e,n,i,o){(kt(e)?D:Et)(e,function(e,s){var r,a,l=e,u=t[s];if(e&&((a=kt(e))||zt(e))){for(var c=i.length;c--;)if(r=i[c]==e){u=o[c];break}if(!r){var h;n&&(l=n(u,e),(h="undefined"!=typeof l)&&(u=l)),h||(u=a?kt(u)?u:[]:zt(u)?u:{}),i.push(e),o.push(u),h||p(u,e,n,i,o)}}else n&&(l=n(u,e),"undefined"==typeof l&&(l=e)),"undefined"!=typeof l&&(u=l);t[s]=u})}function f(t,e,n,i,o,s){var a=1&e,u=2&e,c=4&e,h=16&e,p=32&e;if(!u&&!w(t))throw new TypeError;h&&!n.length&&(e&=-17,h=n=!1),p&&!i.length&&(e&=-33,p=i=!1);var m=t&&t.__bindData__;if(m&&m!==!0)return m=r(m),m[2]&&(m[2]=r(m[2])),m[3]&&(m[3]=r(m[3])),!a||1&m[1]||(m[4]=o),!a&&1&m[1]&&(e|=8),!c||4&m[1]||(m[5]=s),h&&dt.apply(m[2]||(m[2]=[]),n),p&&ft.apply(m[3]||(m[3]=[]),i),m[1]|=e,f.apply(null,m);var g=1==e||17===e?l:d;return g([t,e,n,i,o,s])}function m(){J.shadowedProps=$,J.array=J.bottom=J.loop=J.top="",J.init="iterable",J.useHas=!0;for(var t,e=0;t=arguments[e];e++)for(var n in t)J[n]=t[n];var i=J.args;J.firstArg=/^[^,]+/.exec(i)[0];var o=Function("baseCreateCallback, errorClass, errorProto, hasOwnProperty, indicatorObject, isArguments, isArray, isString, keys, objectProto, objectTypes, nonEnumProps, stringClass, stringProto, toString","return function("+i+") {\n"+Mt(J)+"\n}");return o(h,B,ot,ht,A,_,kt,L,J.keys,st,X,bt,G,rt,at)}function g(t){return"function"==typeof t&&lt.test(t)}function v(t){var e,n;return!t||at.call(t)!=H||(e=t.constructor,w(e)&&!(e instanceof e))||!wt.argsClass&&_(t)||!wt.nodeClass&&o(t)?!1:wt.ownLast?(At(t,function(t,e,i){return n=ht.call(i,e),!1}),n!==!1):(At(t,function(t,e){n=e}),"undefined"==typeof n||ht.call(t,n))}function _(t){return t&&"object"==typeof t&&"number"==typeof t.length&&at.call(t)==I||!1}function y(t,e,n,i){return"boolean"!=typeof e&&null!=e&&(i=n,n=e,e=!1),u(t,e,"function"==typeof n&&h(n,i,1))}function b(t){var e=!0;if(!t)return e;var n=at.call(t),i=t.length;return n==R||n==G||(wt.argsClass?n==I:_(t))||n==H&&"number"==typeof i&&w(t.splice)?!i:(Et(t,function(){return e=!1}),e)}function w(t){return"function"==typeof t}function M(t){return!(!t||!X[typeof t])}function L(t){return"string"==typeof t||t&&"object"==typeof t&&at.call(t)==G||!1}function x(t){var e=arguments,n=2;if(!M(t))return t;if("number"!=typeof e[2]&&(n=e.length),n>3&&"function"==typeof e[n-2])var o=h(e[--n-1],e[n--],2);else n>2&&"function"==typeof e[n-1]&&(o=e[--n]);for(var a=r(arguments,1,n),l=-1,u=i(),c=i();++l<n;)p(t,a[l],o,u,c);return s(u),s(c),t}function D(t,e,n){if(e&&"undefined"==typeof n&&kt(t))for(var i=-1,o=t.length;++i<o&&e(t[i],i,t)!==!1;);else Pt(t,e,n);return t}function S(t){for(var e=-1,n=t?t.length:0,i=[];++e<n;){var o=t[e];o&&i.push(o)}return i}function T(t,e){return arguments.length>2?f(t,17,r(arguments,2),null,e):f(t,1,null,null,e)}function C(t){return t}function P(){}var O=[],A={},E=40,z=/\w*$/,Y=/^\s*function[ \n\r\t]+\w/,N=/\bthis\b/,$=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],I="[object Arguments]",R="[object Array]",F="[object Boolean]",j="[object Date]",B="[object Error]",U="[object Function]",W="[object Number]",H="[object Object]",V="[object RegExp]",G="[object String]",Z={};Z[U]=!1,Z[I]=Z[R]=Z[F]=Z[j]=Z[W]=Z[H]=Z[V]=Z[G]=!0;var q={configurable:!1,enumerable:!1,value:null,writable:!1},J={args:"",array:null,bottom:"",firstArg:"",init:"",keys:null,loop:"",shadowedProps:null,support:null,top:"",useHas:!1},X={"boolean":!1,"function":!0,object:!0,number:!1,string:!1,undefined:!1},K=X[typeof window]&&window||this,Q=X[typeof n]&&n&&!n.nodeType&&n,tt=X[typeof e]&&e&&!e.nodeType&&e,et=tt&&tt.exports===Q&&Q,nt=X[typeof t]&&t;!nt||nt.global!==nt&&nt.window!==nt||(K=nt);var it=[],ot=Error.prototype,st=Object.prototype,rt=String.prototype,at=st.toString,lt=RegExp("^"+String(at).replace(/[.*+?^${}()|[\]\\]/g,"\\$&").replace(/toString| for [^\]]+/g,".*?")+"$"),ut=Function.prototype.toString,ct=g(ct=Object.getPrototypeOf)&&ct,ht=st.hasOwnProperty,dt=it.push,pt=st.propertyIsEnumerable,ft=it.unshift,mt=function(){try{var t={},e=g(e=Object.defineProperty)&&e,n=e(t,t,t)&&e}catch(i){}return n}(),gt=g(gt=Object.create)&&gt,vt=g(vt=Array.isArray)&&vt,_t=g(_t=Object.keys)&&_t,yt={};yt[R]=Array,yt[F]=Boolean,yt[j]=Date,yt[U]=Function,yt[H]=Object,yt[W]=Number,yt[V]=RegExp,yt[G]=String;var bt={};bt[R]=bt[j]=bt[W]={constructor:!0,toLocaleString:!0,toString:!0,valueOf:!0},bt[F]=bt[G]={constructor:!0,toString:!0,valueOf:!0},bt[B]=bt[U]=bt[V]={constructor:!0,toString:!0},bt[H]={constructor:!0},function(){for(var t=$.length;t--;){var e=$[t];for(var n in bt)ht.call(bt,n)&&!ht.call(bt[n],e)&&(bt[n][e]=!1)}}();var wt=a.support={};!function(){var t=function(){this.x=1},e={0:1,length:1},n=[];t.prototype={valueOf:1,y:1};for(var i in new t)n.push(i);for(i in arguments);wt.argsClass=at.call(arguments)==I,wt.argsObject=arguments.constructor==Object&&!(arguments instanceof Array),wt.enumErrorProps=pt.call(ot,"message")||pt.call(ot,"name"),wt.enumPrototypes=pt.call(t,"prototype"),wt.funcDecomp=!g(K.WinRTError)&&N.test(function(){return this}),wt.funcNames="string"==typeof Function.name,wt.nonEnumArgs=0!=i,wt.nonEnumShadows=!/valueOf/.test(n),wt.ownLast="x"!=n[0],wt.spliceObjects=(it.splice.call(e,0,1),!e[0]),wt.unindexedChars="x"[0]+Object("x")[0]!="xx";try{wt.nodeClass=!(at.call(document)==H&&!({toString:0}+""))}catch(o){wt.nodeClass=!0}}(1);var Mt=function(t){var e="var index, iterable = "+t.firstArg+", result = "+t.init+";\nif (!iterable) return result;\n"+t.top+";";t.array?(e+="\nvar length = iterable.length; index = -1;\nif ("+t.array+") {  ",wt.unindexedChars&&(e+="\n  if (isString(iterable)) {\n    iterable = iterable.split('')\n  }  "),e+="\n  while (++index < length) {\n    "+t.loop+";\n  }\n}\nelse {  "):wt.nonEnumArgs&&(e+="\n  var length = iterable.length; index = -1;\n  if (length && isArguments(iterable)) {\n    while (++index < length) {\n      index += '';\n      "+t.loop+";\n    }\n  } else {  "),wt.enumPrototypes&&(e+="\n  var skipProto = typeof iterable == 'function';\n  "),wt.enumErrorProps&&(e+="\n  var skipErrorProps = iterable === errorProto || iterable instanceof Error;\n  ");var n=[];if(wt.enumPrototypes&&n.push('!(skipProto && index == "prototype")'),wt.enumErrorProps&&n.push('!(skipErrorProps && (index == "message" || index == "name"))'),t.useHas&&t.keys)e+="\n  var ownIndex = -1,\n      ownProps = objectTypes[typeof iterable] && keys(iterable),\n      length = ownProps ? ownProps.length : 0;\n\n  while (++ownIndex < length) {\n    index = ownProps[ownIndex];\n",n.length&&(e+="    if ("+n.join(" && ")+") {\n  "),e+=t.loop+";    ",n.length&&(e+="\n    }"),e+="\n  }  ";else if(e+="\n  for (index in iterable) {\n",t.useHas&&n.push("hasOwnProperty.call(iterable, index)"),n.length&&(e+="    if ("+n.join(" && ")+") {\n  "),e+=t.loop+";    ",n.length&&(e+="\n    }"),e+="\n  }    ",wt.nonEnumShadows){for(e+="\n\n  if (iterable !== objectProto) {\n    var ctor = iterable.constructor,\n        isProto = iterable === (ctor && ctor.prototype),\n        className = iterable === stringProto ? stringClass : iterable === errorProto ? errorClass : toString.call(iterable),\n        nonEnum = nonEnumProps[className];\n      ",k=0;k<7;k++)e+="\n    index = '"+t.shadowedProps[k]+"';\n    if ((!(isProto && nonEnum[index]) && hasOwnProperty.call(iterable, index))",t.useHas||(e+=" || (!nonEnum[index] && iterable[index] !== objectProto[index])"),e+=") {\n      "+t.loop+";\n    }      ";e+="\n  }    "}return(t.array||wt.nonEnumArgs)&&(e+="\n}"),e+=t.bottom+";\nreturn result"};gt||(c=function(){function t(){}return function(e){if(M(e)){t.prototype=e;var n=new t;t.prototype=null}return n||K.Object()}}());var Lt=mt?function(t,e){q.value=e,mt(t,"__bindData__",q)}:P;wt.argsClass||(_=function(t){return t&&"object"==typeof t&&"number"==typeof t.length&&ht.call(t,"callee")&&!pt.call(t,"callee")||!1});var kt=vt||function(t){return t&&"object"==typeof t&&"number"==typeof t.length&&at.call(t)==R||!1},xt=m({args:"object",init:"[]",top:"if (!(objectTypes[typeof object])) return result",loop:"result.push(index)"}),Dt=_t?function(t){return M(t)?wt.enumPrototypes&&"function"==typeof t||wt.nonEnumArgs&&t.length&&_(t)?xt(t):_t(t):[]}:xt,St={args:"collection, callback, thisArg",top:"callback = callback && typeof thisArg == 'undefined' ? callback : baseCreateCallback(callback, thisArg, 3)",array:"typeof length == 'number'",keys:Dt,loop:"if (callback(iterable[index], index, collection) === false) return result"},Tt={args:"object, source, guard",top:"var args = arguments,\n    argsIndex = 0,\n    argsLength = typeof guard == 'number' ? 2 : args.length;\nwhile (++argsIndex < argsLength) {\n  iterable = args[argsIndex];\n  if (iterable && objectTypes[typeof iterable]) {",keys:Dt,loop:"if (typeof result[index] == 'undefined') result[index] = iterable[index]",bottom:"  }\n}"},Ct={top:"if (!objectTypes[typeof iterable]) return result;\n"+St.top,array:!1},Pt=m(St),Ot=m(Tt,{top:Tt.top.replace(";",";\nif (argsLength > 3 && typeof args[argsLength - 2] == 'function') {\n  var callback = baseCreateCallback(args[--argsLength - 1], args[argsLength--], 2);\n} else if (argsLength > 2 && typeof args[argsLength - 1] == 'function') {\n  callback = args[--argsLength];\n}"),loop:"result[index] = callback ? callback(result[index], iterable[index]) : iterable[index]"}),At=m(St,Ct,{useHas:!1}),Et=m(St,Ct);w(/x/)&&(w=function(t){return"function"==typeof t&&at.call(t)==U});var zt=ct?function(t){if(!t||at.call(t)!=H||!wt.argsClass&&_(t))return!1;var e=t.valueOf,n=g(e)&&(n=ct(e))&&ct(n);return n?t==n||ct(t)==n:v(t)}:v;a.assign=Ot,a.bind=T,a.compact=S,a.forEach=D,a.forIn=At,a.forOwn=Et,a.keys=Dt,a.merge=x,a.each=D,a.extend=Ot,a.clone=y,a.identity=C,a.isArguments=_,a.isArray=kt,a.isEmpty=b,a.isFunction=w,a.isObject=M,a.isPlainObject=zt,a.isString=L,a.noop=P,a.VERSION="2.4.1",Q&&tt&&et&&((tt.exports=a)._=a)}).call(this)}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],86:[function(t,e,n){function i(t,e){switch(t&&t.type||null){case"FeatureCollection":return t.features=t.features.map(o(i,e)),t;case"Feature":return t.geometry=i(t.geometry,e),t;case"Polygon":case"MultiPolygon":return s(t,e);default:return t}}function o(t,e){return function(n){return t(n,e)}}function s(t,e){return"Polygon"===t.type?t.coordinates=r(t.coordinates,e):"MultiPolygon"===t.type&&(t.coordinates=t.coordinates.map(o(r,e))),t}function r(t,e){e=!!e,t[0]=a(t[0],!e);for(var n=1;n<t.length;n++)t[n]=a(t[n],e);return t}function a(t,e){return l(t)===e?t:t.reverse()}function l(t){return u.ring(t)>=0}var u=t("geojson-area");e.exports=i},{"geojson-area":87}],87:[function(t,e,n){function i(t){if("Polygon"===t.type)return o(t.coordinates);if("MultiPolygon"===t.type){for(var e=0,n=0;n<t.coordinates.length;n++)e+=o(t.coordinates[n]);return e}return null}function o(t){var e=0;if(t&&t.length>0){e+=Math.abs(s(t[0]));for(var n=1;n<t.length;n++)e-=Math.abs(s(t[n]))}return e}function s(t){var e=0;if(t.length>2){for(var n,i,o=0;o<t.length-1;o++)n=t[o],i=t[o+1],e+=r(i[0]-n[0])*(2+Math.sin(r(n[1]))+Math.sin(r(i[1])));e=e*a.RADIUS*a.RADIUS/2}return e}function r(t){return t*Math.PI/180}var a=t("wgs84");e.exports.geometry=i,e.exports.ring=s},{wgs84:88}],88:[function(t,e,n){e.exports.RADIUS=6378137,e.exports.FLATTENING=1/298.257223563,e.exports.POLAR_RADIUS=6356752.3142},{}],89:[function(t,e,n){e.exports={building:!0,highway:{included_values:{services:!0,rest_area:!0,escape:!0}},natural:{excluded_values:{coastline:!0,cliff:!0,ridge:!0,arete:!0,tree_row:!0}},landuse:!0,waterway:{included_values:{riverbank:!0,dock:!0,boatyard:!0,dam:!0}},amenity:!0,leisure:!0,barrier:{included_values:{city_wall:!0,ditch:!0,hedge:!0,retaining_wall:!0,wall:!0,spikes:!0}},railway:{included_values:{station:!0,turntable:!0,roundhouse:!0,platform:!0}},area:!0,boundary:!0,man_made:{excluded_values:{cutline:!0,embankment:!0,pipeline:!0}},power:{included_values:{plant:!0,substation:!0,generator:!0,transformer:!0}},place:!0,shop:!0,aeroway:{excluded_values:{taxiway:!0}},tourism:!0,historic:!0,public_transport:!0,office:!0,"building:part":!0,military:!0,ruins:!0,"area:highway":!0,craft:!0,golf:!0}},{}]},{},[8]);